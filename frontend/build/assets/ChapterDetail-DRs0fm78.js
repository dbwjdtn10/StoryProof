import{M as qr,m as _e,E as ue,a as ao,b as co,N as ot,n as uo,R as po,P as Kr,c as Hn,S as xe,d as fo,T as ve,F as de,e as we,D as vn,f as wn,k as ho,g as mo,h as go,i as xo,l as bo,o as yo,u as vo,U as wo,p as Co,q as jo,H as So,r as No,s as ko,j as o,t as Ro}from"./tiptap-BONCSYqO.js";import{r as v,R as pn,t as M}from"./toast-Dj7VaHEs.js";import{c as Vr,T as Eo,d as Ao,P as To,e as Et,f as zo,g as lr,h as Oo,i as _o,H as Mo,j as Lo,k as Cn,l as Gr,m as ce,n as se,o as jn,p as Ho,q as Po,r as Sn,s as Io,X as it,t as Do,R as Fo,u as Bo,v as ar,N as $o,w as Wo,x as Uo,U as qo,y as cr,A as Ko,z as dr,D as fn,F as At,G as Vo,I as ur,J as hn,K as mn,O as pr,Q as Tt,V as fr}from"./icons-DMwvs2NW.js";import{u as Jr,r as Xr,A as Nn,g as Go,a as Jo,b as Xo,T as Yo,c as Qo,d as Zo,e as ei,f as ti,h as ni}from"./index-Cz4Ttz_3.js";var ri=20,Yr=(e,t=0)=>{const n=[];return!e.children.length||t>ri||Array.from(e.children).forEach(r=>{r.tagName==="SPAN"?n.push(r):r.children.length&&n.push(...Yr(r,t+1))}),n},si=e=>{if(!e.children.length)return;const t=Yr(e);t&&t.forEach(n=>{var r,s;const i=n.getAttribute("style"),l=(s=(r=n.parentElement)==null?void 0:r.closest("span"))==null?void 0:s.getAttribute("style");n.setAttribute("style",`${l};${i}`)})},Qr=qr.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!0}},parseHTML(){return[{tag:"span",consuming:!1,getAttrs:e=>e.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&si(e),{}):!1}]},renderHTML({HTMLAttributes:e}){return["span",_e(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleTextStyle:e=>({commands:t})=>t.toggleMark(this.name,e),removeEmptyTextStyle:()=>({tr:e})=>{const{selection:t}=e;return e.doc.nodesBetween(t.from,t.to,(n,r)=>{if(n.isTextblock)return!0;n.marks.filter(s=>s.type===this.type).some(s=>Object.values(s.attrs).some(i=>!!i))||e.removeMark(r,r+n.nodeSize,this.type)}),!0}}}}),oi=ue.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:e=>{var t;const n=e.getAttribute("style");if(n){const r=n.split(";").map(s=>s.trim()).filter(Boolean);for(let s=r.length-1;s>=0;s-=1){const i=r[s].split(":");if(i.length>=2){const l=i[0].trim().toLowerCase(),a=i.slice(1).join(":").trim();if(l==="background-color")return a.replace(/['"]+/g,"")}}}return(t=e.style.backgroundColor)==null?void 0:t.replace(/['"]+/g,"")},renderHTML:e=>e.backgroundColor?{style:`background-color: ${e.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:e=>({chain:t})=>t().setMark("textStyle",{backgroundColor:e}).run(),unsetBackgroundColor:()=>({chain:e})=>e().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),Zr=ue.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:e=>{var t;const n=e.getAttribute("style");if(n){const r=n.split(";").map(s=>s.trim()).filter(Boolean);for(let s=r.length-1;s>=0;s-=1){const i=r[s].split(":");if(i.length>=2){const l=i[0].trim().toLowerCase(),a=i.slice(1).join(":").trim();if(l==="color")return a.replace(/['"]+/g,"")}}}return(t=e.style.color)==null?void 0:t.replace(/['"]+/g,"")},renderHTML:e=>e.color?{style:`color: ${e.color}`}:{}}}}]},addCommands(){return{setColor:e=>({chain:t})=>t().setMark("textStyle",{color:e}).run(),unsetColor:()=>({chain:e})=>e().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),es=ue.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:e=>e.style.fontFamily,renderHTML:e=>e.fontFamily?{style:`font-family: ${e.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:e=>({chain:t})=>t().setMark("textStyle",{fontFamily:e}).run(),unsetFontFamily:()=>({chain:e})=>e().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),ii=ue.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:e=>e.style.fontSize,renderHTML:e=>e.fontSize?{style:`font-size: ${e.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:e=>({chain:t})=>t().setMark("textStyle",{fontSize:e}).run(),unsetFontSize:()=>({chain:e})=>e().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),li=ue.create({name:"lineHeight",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:e=>e.style.lineHeight,renderHTML:e=>e.lineHeight?{style:`line-height: ${e.lineHeight}`}:{}}}}]},addCommands(){return{setLineHeight:e=>({chain:t})=>t().setMark("textStyle",{lineHeight:e}).run(),unsetLineHeight:()=>({chain:e})=>e().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()}}});ue.create({name:"textStyleKit",addExtensions(){const e=[];return this.options.backgroundColor!==!1&&e.push(oi.configure(this.options.backgroundColor)),this.options.color!==!1&&e.push(Zr.configure(this.options.color)),this.options.fontFamily!==!1&&e.push(es.configure(this.options.fontFamily)),this.options.fontSize!==!1&&e.push(ii.configure(this.options.fontSize)),this.options.lineHeight!==!1&&e.push(li.configure(this.options.lineHeight)),this.options.textStyle!==!1&&e.push(Qr.configure(this.options.textStyle)),e}});var ai=ue.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:e=>{const t=e.style.textAlign;return this.options.alignments.includes(t)?t:this.options.defaultAlignment},renderHTML:e=>e.textAlign?{style:`text-align: ${e.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:e=>({commands:t})=>this.options.alignments.includes(e)?this.options.types.map(n=>t.updateAttributes(n,{textAlign:e})).some(n=>n):!1,unsetTextAlign:()=>({commands:e})=>this.options.types.map(t=>e.resetAttributes(t,"textAlign")).some(t=>t),toggleTextAlign:e=>({editor:t,commands:n})=>this.options.alignments.includes(e)?t.isActive({textAlign:e})?n.unsetTextAlign():n.setTextAlign(e):!1}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),ci=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,di=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,ui=qr.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:e=>e.getAttribute("data-color")||e.style.backgroundColor,renderHTML:e=>e.color?{"data-color":e.color,style:`background-color: ${e.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:e}){return["mark",_e(this.options.HTMLAttributes,e),0]},renderMarkdown:(e,t)=>`==${t.renderChildren(e)}==`,parseMarkdown:(e,t)=>t.applyMark("highlight",t.parseInline(e.tokens||[])),markdownTokenizer:{name:"highlight",level:"inline",start:e=>e.indexOf("=="),tokenize(e,t,n){const s=/^(==)([^=]+)(==)/.exec(e);if(s){const i=s[2].trim(),l=n.inlineTokens(i);return{type:"highlight",raw:s[0],text:i,tokens:l}}}},addCommands(){return{setHighlight:e=>({commands:t})=>t.setMark(this.name,e),toggleHighlight:e=>({commands:t})=>t.toggleMark(this.name,e),unsetHighlight:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[co({find:ci,type:this.type})]},addPasteRules(){return[ao({find:di,type:this.type})]}}),pi=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,fi=ot.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:e}){return["img",_e(this.options.HTMLAttributes,e)]},parseMarkdown:(e,t)=>t.createNode("image",{src:e.href,title:e.title,alt:e.text}),renderMarkdown:e=>{var t,n,r,s,i,l;const a=(n=(t=e.attrs)==null?void 0:t.src)!=null?n:"",c=(s=(r=e.attrs)==null?void 0:r.alt)!=null?s:"",d=(l=(i=e.attrs)==null?void 0:i.title)!=null?l:"";return d?`![${c}](${a} "${d}")`:`![${c}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u")return null;const{directions:e,minWidth:t,minHeight:n,alwaysPreserveAspectRatio:r}=this.options.resize;return({node:s,getPos:i,HTMLAttributes:l,editor:a})=>{const c=document.createElement("img");Object.entries(l).forEach(([p,g])=>{if(g!=null)switch(p){case"width":case"height":break;default:c.setAttribute(p,g);break}}),c.src=l.src;const d=new po({element:c,editor:a,node:s,getPos:i,onResize:(p,g)=>{c.style.width=`${p}px`,c.style.height=`${g}px`},onCommit:(p,g)=>{const h=i();h!==void 0&&this.editor.chain().setNodeSelection(h).updateAttributes(this.name,{width:p,height:g}).run()},onUpdate:(p,g,h)=>p.type===s.type,options:{directions:e,min:{width:t,height:n},preserveAspectRatio:r===!0}}),u=d.dom;return u.style.visibility="hidden",u.style.pointerEvents="none",c.onload=()=>{u.style.visibility="",u.style.pointerEvents=""},d}},addCommands(){return{setImage:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addInputRules(){return[uo({find:pi,type:this.type,getAttributes:e=>{const[,,t,n,r]=e;return{src:n,alt:t,title:r}}})]}});let kn,Rn;if(typeof WeakMap<"u"){let e=new WeakMap;kn=t=>e.get(t),Rn=(t,n)=>(e.set(t,n),n)}else{const e=[];let n=0;kn=r=>{for(let s=0;s<e.length;s+=2)if(e[s]==r)return e[s+1]},Rn=(r,s)=>(n==10&&(n=0),e[n++]=r,e[n++]=s)}var D=class{constructor(e,t,n,r){this.width=e,this.height=t,this.map=n,this.problems=r}findCell(e){for(let t=0;t<this.map.length;t++){const n=this.map[t];if(n!=e)continue;const r=t%this.width,s=t/this.width|0;let i=r+1,l=s+1;for(let a=1;i<this.width&&this.map[t+a]==n;a++)i++;for(let a=1;l<this.height&&this.map[t+this.width*a]==n;a++)l++;return{left:r,top:s,right:i,bottom:l}}throw new RangeError(`No cell with offset ${e} found`)}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError(`No cell with offset ${e} found`)}nextCell(e,t,n){const{left:r,right:s,top:i,bottom:l}=this.findCell(e);return t=="horiz"?(n<0?r==0:s==this.width)?null:this.map[i*this.width+(n<0?r-1:s)]:(n<0?i==0:l==this.height)?null:this.map[r+this.width*(n<0?i-1:l)]}rectBetween(e,t){const{left:n,right:r,top:s,bottom:i}=this.findCell(e),{left:l,right:a,top:c,bottom:d}=this.findCell(t);return{left:Math.min(n,l),top:Math.min(s,c),right:Math.max(r,a),bottom:Math.max(i,d)}}cellsInRect(e){const t=[],n={};for(let r=e.top;r<e.bottom;r++)for(let s=e.left;s<e.right;s++){const i=r*this.width+s,l=this.map[i];n[l]||(n[l]=!0,!(s==e.left&&s&&this.map[i-1]==l||r==e.top&&r&&this.map[i-this.width]==l)&&t.push(l))}return t}positionAt(e,t,n){for(let r=0,s=0;;r++){const i=s+n.child(r).nodeSize;if(r==e){let l=t+e*this.width;const a=(e+1)*this.width;for(;l<a&&this.map[l]<s;)l++;return l==a?i-1:this.map[l]}s=i}}static get(e){return kn(e)||Rn(e,hi(e))}};function hi(e){if(e.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+e.type.name);const t=mi(e),n=e.childCount,r=[];let s=0,i=null;const l=[];for(let d=0,u=t*n;d<u;d++)r[d]=0;for(let d=0,u=0;d<n;d++){const p=e.child(d);u++;for(let m=0;;m++){for(;s<r.length&&r[s]!=0;)s++;if(m==p.childCount)break;const y=p.child(m),{colspan:b,rowspan:C,colwidth:T}=y.attrs;for(let R=0;R<C;R++){if(R+d>=n){(i||(i=[])).push({type:"overlong_rowspan",pos:u,n:C-R});break}const z=s+R*t;for(let E=0;E<b;E++){r[z+E]==0?r[z+E]=u:(i||(i=[])).push({type:"collision",row:d,pos:u,n:b-E});const U=T&&T[E];if(U){const B=(z+E)%t*2,le=l[B];le==null||le!=U&&l[B+1]==1?(l[B]=U,l[B+1]=1):le==U&&l[B+1]++}}}s+=b,u+=y.nodeSize}const g=(d+1)*t;let h=0;for(;s<g;)r[s++]==0&&h++;h&&(i||(i=[])).push({type:"missing",row:d,n:h}),u++}(t===0||n===0)&&(i||(i=[])).push({type:"zero_sized"});const a=new D(t,n,r,i);let c=!1;for(let d=0;!c&&d<l.length;d+=2)l[d]!=null&&l[d+1]<n&&(c=!0);return c&&gi(a,l,e),a}function mi(e){let t=-1,n=!1;for(let r=0;r<e.childCount;r++){const s=e.child(r);let i=0;if(n)for(let l=0;l<r;l++){const a=e.child(l);for(let c=0;c<a.childCount;c++){const d=a.child(c);l+d.attrs.rowspan>r&&(i+=d.attrs.colspan)}}for(let l=0;l<s.childCount;l++){const a=s.child(l);i+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}t==-1?t=i:t!=i&&(t=Math.max(t,i))}return t}function gi(e,t,n){e.problems||(e.problems=[]);const r={};for(let s=0;s<e.map.length;s++){const i=e.map[s];if(r[i])continue;r[i]=!0;const l=n.nodeAt(i);if(!l)throw new RangeError(`No cell with offset ${i} found`);let a=null;const c=l.attrs;for(let d=0;d<c.colspan;d++){const u=t[(s+d)%e.width*2];u!=null&&(!c.colwidth||c.colwidth[d]!=u)&&((a||(a=xi(c)))[d]=u)}a&&e.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:a})}}function xi(e){if(e.colwidth)return e.colwidth.slice();const t=[];for(let n=0;n<e.colspan;n++)t.push(0);return t}function G(e){let t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(const n in e.nodes){const r=e.nodes[n],s=r.spec.tableRole;s&&(t[s]=r)}}return t}const ye=new Hn("selectingCells");function Te(e){for(let t=e.depth-1;t>0;t--)if(e.node(t).type.spec.tableRole=="row")return e.node(0).resolve(e.before(t+1));return null}function bi(e){for(let t=e.depth;t>0;t--){const n=e.node(t).type.spec.tableRole;if(n==="cell"||n==="header_cell")return e.node(t)}return null}function oe(e){const t=e.selection.$head;for(let n=t.depth;n>0;n--)if(t.node(n).type.spec.tableRole=="row")return!0;return!1}function $t(e){const t=e.selection;if("$anchorCell"in t&&t.$anchorCell)return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell;if("node"in t&&t.node&&t.node.type.spec.tableRole=="cell")return t.$anchor;const n=Te(t.$head)||yi(t.$head);if(n)return n;throw new RangeError(`No cell found around position ${t.head}`)}function yi(e){for(let t=e.nodeAfter,n=e.pos;t;t=t.firstChild,n++){const r=t.type.spec.tableRole;if(r=="cell"||r=="header_cell")return e.doc.resolve(n)}for(let t=e.nodeBefore,n=e.pos;t;t=t.lastChild,n--){const r=t.type.spec.tableRole;if(r=="cell"||r=="header_cell")return e.doc.resolve(n-t.nodeSize)}}function En(e){return e.parent.type.spec.tableRole=="row"&&!!e.nodeAfter}function vi(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function Pn(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function ts(e,t,n){const r=e.node(-1),s=D.get(r),i=e.start(-1),l=s.nextCell(e.pos-i,t,n);return l==null?null:e.node(0).resolve(i+l)}function ze(e,t,n=1){const r={...e,colspan:e.colspan-n};return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(t,n),r.colwidth.some(s=>s>0)||(r.colwidth=null)),r}function ns(e,t,n=1){const r={...e,colspan:e.colspan+n};if(r.colwidth){r.colwidth=r.colwidth.slice();for(let s=0;s<n;s++)r.colwidth.splice(t,0,0)}return r}function wi(e,t,n){const r=G(t.type.schema).header_cell;for(let s=0;s<e.height;s++)if(t.nodeAt(e.map[n+s*e.width]).type!=r)return!1;return!0}var H=class ge extends xe{constructor(t,n=t){const r=t.node(-1),s=D.get(r),i=t.start(-1),l=s.rectBetween(t.pos-i,n.pos-i),a=t.node(0),c=s.cellsInRect(l).filter(u=>u!=n.pos-i);c.unshift(n.pos-i);const d=c.map(u=>{const p=r.nodeAt(u);if(!p)throw new RangeError(`No cell with offset ${u} found`);const g=i+u+1;return new fo(a.resolve(g),a.resolve(g+p.content.size))});super(d[0].$from,d[0].$to,d),this.$anchorCell=t,this.$headCell=n}map(t,n){const r=t.resolve(n.map(this.$anchorCell.pos)),s=t.resolve(n.map(this.$headCell.pos));if(En(r)&&En(s)&&Pn(r,s)){const i=this.$anchorCell.node(-1)!=r.node(-1);return i&&this.isRowSelection()?ge.rowSelection(r,s):i&&this.isColSelection()?ge.colSelection(r,s):new ge(r,s)}return ve.between(r,s)}content(){const t=this.$anchorCell.node(-1),n=D.get(t),r=this.$anchorCell.start(-1),s=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),i={},l=[];for(let c=s.top;c<s.bottom;c++){const d=[];for(let u=c*n.width+s.left,p=s.left;p<s.right;p++,u++){const g=n.map[u];if(i[g])continue;i[g]=!0;const h=n.findCell(g);let m=t.nodeAt(g);if(!m)throw new RangeError(`No cell with offset ${g} found`);const y=s.left-h.left,b=h.right-s.right;if(y>0||b>0){let C=m.attrs;if(y>0&&(C=ze(C,0,y)),b>0&&(C=ze(C,C.colspan-b,b)),h.left<s.left){if(m=m.type.createAndFill(C),!m)throw new RangeError(`Could not create cell with attrs ${JSON.stringify(C)}`)}else m=m.type.create(C,m.content)}if(h.top<s.top||h.bottom>s.bottom){const C={...m.attrs,rowspan:Math.min(h.bottom,s.bottom)-Math.max(h.top,s.top)};h.top<s.top?m=m.type.createAndFill(C):m=m.type.create(C,m.content)}d.push(m)}l.push(t.child(c).copy(de.from(d)))}const a=this.isColSelection()&&this.isRowSelection()?t:l;return new we(de.from(a),1,1)}replace(t,n=we.empty){const r=t.steps.length,s=this.ranges;for(let l=0;l<s.length;l++){const{$from:a,$to:c}=s[l],d=t.mapping.slice(r);t.replace(d.map(a.pos),d.map(c.pos),l?we.empty:n)}const i=xe.findFrom(t.doc.resolve(t.mapping.slice(r).map(this.to)),-1);i&&t.setSelection(i)}replaceWith(t,n){this.replace(t,new we(de.from(n),0,0))}forEachCell(t){const n=this.$anchorCell.node(-1),r=D.get(n),s=this.$anchorCell.start(-1),i=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let l=0;l<i.length;l++)t(n.nodeAt(i[l]),s+i[l])}isColSelection(){const t=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(t,n)>0)return!1;const r=t+this.$anchorCell.nodeAfter.attrs.rowspan,s=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,s)==this.$headCell.node(-1).childCount}static colSelection(t,n=t){const r=t.node(-1),s=D.get(r),i=t.start(-1),l=s.findCell(t.pos-i),a=s.findCell(n.pos-i),c=t.node(0);return l.top<=a.top?(l.top>0&&(t=c.resolve(i+s.map[l.left])),a.bottom<s.height&&(n=c.resolve(i+s.map[s.width*(s.height-1)+a.right-1]))):(a.top>0&&(n=c.resolve(i+s.map[a.left])),l.bottom<s.height&&(t=c.resolve(i+s.map[s.width*(s.height-1)+l.right-1]))),new ge(t,n)}isRowSelection(){const t=this.$anchorCell.node(-1),n=D.get(t),r=this.$anchorCell.start(-1),s=n.colCount(this.$anchorCell.pos-r),i=n.colCount(this.$headCell.pos-r);if(Math.min(s,i)>0)return!1;const l=s+this.$anchorCell.nodeAfter.attrs.colspan,a=i+this.$headCell.nodeAfter.attrs.colspan;return Math.max(l,a)==n.width}eq(t){return t instanceof ge&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,n=t){const r=t.node(-1),s=D.get(r),i=t.start(-1),l=s.findCell(t.pos-i),a=s.findCell(n.pos-i),c=t.node(0);return l.left<=a.left?(l.left>0&&(t=c.resolve(i+s.map[l.top*s.width])),a.right<s.width&&(n=c.resolve(i+s.map[s.width*(a.top+1)-1]))):(a.left>0&&(n=c.resolve(i+s.map[a.top*s.width])),l.right<s.width&&(t=c.resolve(i+s.map[s.width*(l.top+1)-1]))),new ge(t,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,n){return new ge(t.resolve(n.anchor),t.resolve(n.head))}static create(t,n,r=n){return new ge(t.resolve(n),t.resolve(r))}getBookmark(){return new Ci(this.$anchorCell.pos,this.$headCell.pos)}};H.prototype.visible=!1;xe.jsonID("cell",H);var Ci=class rs{constructor(t,n){this.anchor=t,this.head=n}map(t){return new rs(t.map(this.anchor),t.map(this.head))}resolve(t){const n=t.resolve(this.anchor),r=t.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&Pn(n,r)?new H(n,r):xe.near(r,1)}};function ji(e){if(!(e.selection instanceof H))return null;const t=[];return e.selection.forEachCell((n,r)=>{t.push(wn.node(r,r+n.nodeSize,{class:"selectedCell"}))}),vn.create(e.doc,t)}function Si({$from:e,$to:t}){if(e.pos==t.pos||e.pos<t.pos-6)return!1;let n=e.pos,r=t.pos,s=e.depth;for(;s>=0&&!(e.after(s+1)<e.end(s));s--,n++);for(let i=t.depth;i>=0&&!(t.before(i+1)>t.start(i));i--,r--);return n==r&&/row|table/.test(e.node(s).type.spec.tableRole)}function Ni({$from:e,$to:t}){let n,r;for(let s=e.depth;s>0;s--){const i=e.node(s);if(i.type.spec.tableRole==="cell"||i.type.spec.tableRole==="header_cell"){n=i;break}}for(let s=t.depth;s>0;s--){const i=t.node(s);if(i.type.spec.tableRole==="cell"||i.type.spec.tableRole==="header_cell"){r=i;break}}return n!==r&&t.parentOffset===0}function ki(e,t,n){const r=(t||e).selection,s=(t||e).doc;let i,l;if(r instanceof mo&&(l=r.node.type.spec.tableRole)){if(l=="cell"||l=="header_cell")i=H.create(s,r.from);else if(l=="row"){const a=s.resolve(r.from+1);i=H.rowSelection(a,a)}else if(!n){const a=D.get(r.node),c=r.from+1,d=c+a.map[a.width*a.height-1];i=H.create(s,c+1,d)}}else r instanceof ve&&Si(r)?i=ve.create(s,r.from):r instanceof ve&&Ni(r)&&(i=ve.create(s,r.$from.start(),r.$from.end()));return i&&(t||(t=e.tr)).setSelection(i),t}const Ri=new Hn("fix-tables");function ss(e,t,n,r){const s=e.childCount,i=t.childCount;e:for(let l=0,a=0;l<i;l++){const c=t.child(l);for(let d=a,u=Math.min(s,l+3);d<u;d++)if(e.child(d)==c){a=d+1,n+=c.nodeSize;continue e}r(c,n),a<s&&e.child(a).sameMarkup(c)?ss(e.child(a),c,n+1,r):c.nodesBetween(0,c.content.size,r,n+1),n+=c.nodeSize}}function os(e,t){let n;const r=(s,i)=>{s.type.spec.tableRole=="table"&&(n=Ei(e,s,i,n))};return t?t.doc!=e.doc&&ss(t.doc,e.doc,0,r):e.doc.descendants(r),n}function Ei(e,t,n,r){const s=D.get(t);if(!s.problems)return r;r||(r=e.tr);const i=[];for(let c=0;c<s.height;c++)i.push(0);for(let c=0;c<s.problems.length;c++){const d=s.problems[c];if(d.type=="collision"){const u=t.nodeAt(d.pos);if(!u)continue;const p=u.attrs;for(let g=0;g<p.rowspan;g++)i[d.row+g]+=d.n;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,ze(p,p.colspan-d.n,d.n))}else if(d.type=="missing")i[d.row]+=d.n;else if(d.type=="overlong_rowspan"){const u=t.nodeAt(d.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,{...u.attrs,rowspan:u.attrs.rowspan-d.n})}else if(d.type=="colwidth mismatch"){const u=t.nodeAt(d.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,{...u.attrs,colwidth:d.colwidth})}else if(d.type=="zero_sized"){const u=r.mapping.map(n);r.delete(u,u+t.nodeSize)}}let l,a;for(let c=0;c<i.length;c++)i[c]&&(l==null&&(l=c),a=c);for(let c=0,d=n+1;c<s.height;c++){const u=t.child(c),p=d+u.nodeSize,g=i[c];if(g>0){let h="cell";u.firstChild&&(h=u.firstChild.type.spec.tableRole);const m=[];for(let b=0;b<g;b++){const C=G(e.schema)[h].createAndFill();C&&m.push(C)}const y=(c==0||l==c-1)&&a==c?d+1:p-1;r.insert(r.mapping.map(y),m)}d=p}return r.setMeta(Ri,{fixTables:!0})}function pe(e){const t=e.selection,n=$t(e),r=n.node(-1),s=n.start(-1),i=D.get(r);return{...t instanceof H?i.rectBetween(t.$anchorCell.pos-s,t.$headCell.pos-s):i.findCell(n.pos-s),tableStart:s,map:i,table:r}}function is(e,{map:t,tableStart:n,table:r},s){let i=s>0?-1:0;wi(t,r,s+i)&&(i=s==0||s==t.width?null:0);for(let l=0;l<t.height;l++){const a=l*t.width+s;if(s>0&&s<t.width&&t.map[a-1]==t.map[a]){const c=t.map[a],d=r.nodeAt(c);e.setNodeMarkup(e.mapping.map(n+c),null,ns(d.attrs,s-t.colCount(c))),l+=d.attrs.rowspan-1}else{const c=i==null?G(r.type.schema).cell:r.nodeAt(t.map[a+i]).type,d=t.positionAt(l,s,r);e.insert(e.mapping.map(n+d),c.createAndFill())}}return e}function Ai(e,t){if(!oe(e))return!1;if(t){const n=pe(e);t(is(e.tr,n,n.left))}return!0}function Ti(e,t){if(!oe(e))return!1;if(t){const n=pe(e);t(is(e.tr,n,n.right))}return!0}function zi(e,{map:t,table:n,tableStart:r},s){const i=e.mapping.maps.length;for(let l=0;l<t.height;){const a=l*t.width+s,c=t.map[a],d=n.nodeAt(c),u=d.attrs;if(s>0&&t.map[a-1]==c||s<t.width-1&&t.map[a+1]==c)e.setNodeMarkup(e.mapping.slice(i).map(r+c),null,ze(u,s-t.colCount(c)));else{const p=e.mapping.slice(i).map(r+c);e.delete(p,p+d.nodeSize)}l+=u.rowspan}}function Oi(e,t){if(!oe(e))return!1;if(t){const n=pe(e),r=e.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let s=n.right-1;zi(r,n,s),s!=n.left;s--){const i=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!i)throw new RangeError("No table found");n.table=i,n.map=D.get(i)}t(r)}return!0}function _i(e,t,n){var r;const s=G(t.type.schema).header_cell;for(let i=0;i<e.width;i++)if(((r=t.nodeAt(e.map[i+n*e.width]))===null||r===void 0?void 0:r.type)!=s)return!1;return!0}function ls(e,{map:t,tableStart:n,table:r},s){let i=n;for(let d=0;d<s;d++)i+=r.child(d).nodeSize;const l=[];let a=s>0?-1:0;_i(t,r,s+a)&&(a=s==0||s==t.height?null:0);for(let d=0,u=t.width*s;d<t.width;d++,u++)if(s>0&&s<t.height&&t.map[u]==t.map[u-t.width]){const p=t.map[u],g=r.nodeAt(p).attrs;e.setNodeMarkup(n+p,null,{...g,rowspan:g.rowspan+1}),d+=g.colspan-1}else{var c;const p=a==null?G(r.type.schema).cell:(c=r.nodeAt(t.map[u+a*t.width]))===null||c===void 0?void 0:c.type,g=p?.createAndFill();g&&l.push(g)}return e.insert(i,G(r.type.schema).row.create(null,l)),e}function Mi(e,t){if(!oe(e))return!1;if(t){const n=pe(e);t(ls(e.tr,n,n.top))}return!0}function Li(e,t){if(!oe(e))return!1;if(t){const n=pe(e);t(ls(e.tr,n,n.bottom))}return!0}function Hi(e,{map:t,table:n,tableStart:r},s){let i=0;for(let d=0;d<s;d++)i+=n.child(d).nodeSize;const l=i+n.child(s).nodeSize,a=e.mapping.maps.length;e.delete(i+r,l+r);const c=new Set;for(let d=0,u=s*t.width;d<t.width;d++,u++){const p=t.map[u];if(!c.has(p)){if(c.add(p),s>0&&p==t.map[u-t.width]){const g=n.nodeAt(p).attrs;e.setNodeMarkup(e.mapping.slice(a).map(p+r),null,{...g,rowspan:g.rowspan-1}),d+=g.colspan-1}else if(s<t.height&&p==t.map[u+t.width]){const g=n.nodeAt(p),h=g.attrs,m=g.type.create({...h,rowspan:g.attrs.rowspan-1},g.content),y=t.positionAt(s+1,d,n);e.insert(e.mapping.slice(a).map(r+y),m),d+=h.colspan-1}}}}function Pi(e,t){if(!oe(e))return!1;if(t){const n=pe(e),r=e.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let s=n.bottom-1;Hi(r,n,s),s!=n.top;s--){const i=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!i)throw new RangeError("No table found");n.table=i,n.map=D.get(n.table)}t(r)}return!0}function hr(e){const t=e.content;return t.childCount==1&&t.child(0).isTextblock&&t.child(0).childCount==0}function Ii({width:e,height:t,map:n},r){let s=r.top*e+r.left,i=s,l=(r.bottom-1)*e+r.left,a=s+(r.right-r.left-1);for(let c=r.top;c<r.bottom;c++){if(r.left>0&&n[i]==n[i-1]||r.right<e&&n[a]==n[a+1])return!0;i+=e,a+=e}for(let c=r.left;c<r.right;c++){if(r.top>0&&n[s]==n[s-e]||r.bottom<t&&n[l]==n[l+e])return!0;s++,l++}return!1}function mr(e,t){const n=e.selection;if(!(n instanceof H)||n.$anchorCell.pos==n.$headCell.pos)return!1;const r=pe(e),{map:s}=r;if(Ii(s,r))return!1;if(t){const i=e.tr,l={};let a=de.empty,c,d;for(let u=r.top;u<r.bottom;u++)for(let p=r.left;p<r.right;p++){const g=s.map[u*s.width+p],h=r.table.nodeAt(g);if(!(l[g]||!h))if(l[g]=!0,c==null)c=g,d=h;else{hr(h)||(a=a.append(h.content));const m=i.mapping.map(g+r.tableStart);i.delete(m,m+h.nodeSize)}}if(c==null||d==null)return!0;if(i.setNodeMarkup(c+r.tableStart,null,{...ns(d.attrs,d.attrs.colspan,r.right-r.left-d.attrs.colspan),rowspan:r.bottom-r.top}),a.size>0){const u=c+1+d.content.size,p=hr(d)?c+1:u;i.replaceWith(p+r.tableStart,u+r.tableStart,a)}i.setSelection(new H(i.doc.resolve(c+r.tableStart))),t(i)}return!0}function gr(e,t){const n=G(e.schema);return Di(({node:r})=>n[r.type.spec.tableRole])(e,t)}function Di(e){return(t,n)=>{const r=t.selection;let s,i;if(r instanceof H){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;s=r.$anchorCell.nodeAfter,i=r.$anchorCell.pos}else{var l;if(s=bi(r.$from),!s)return!1;i=(l=Te(r.$from))===null||l===void 0?void 0:l.pos}if(s==null||i==null||s.attrs.colspan==1&&s.attrs.rowspan==1)return!1;if(n){let a=s.attrs;const c=[],d=a.colwidth;a.rowspan>1&&(a={...a,rowspan:1}),a.colspan>1&&(a={...a,colspan:1});const u=pe(t),p=t.tr;for(let h=0;h<u.right-u.left;h++)c.push(d?{...a,colwidth:d&&d[h]?[d[h]]:null}:a);let g;for(let h=u.top;h<u.bottom;h++){let m=u.map.positionAt(h,u.left,u.table);h==u.top&&(m+=s.nodeSize);for(let y=u.left,b=0;y<u.right;y++,b++)y==u.left&&h==u.top||p.insert(g=p.mapping.map(m+u.tableStart,1),e({node:s,row:h,col:y}).createAndFill(c[b]))}p.setNodeMarkup(i,e({node:s,row:u.top,col:u.left}),c[0]),r instanceof H&&p.setSelection(new H(p.doc.resolve(r.$anchorCell.pos),g?p.doc.resolve(g):void 0)),n(p)}return!0}}function Fi(e,t){return function(n,r){if(!oe(n))return!1;const s=$t(n);if(s.nodeAfter.attrs[e]===t)return!1;if(r){const i=n.tr;n.selection instanceof H?n.selection.forEachCell((l,a)=>{l.attrs[e]!==t&&i.setNodeMarkup(a,null,{...l.attrs,[e]:t})}):i.setNodeMarkup(s.pos,null,{...s.nodeAfter.attrs,[e]:t}),r(i)}return!0}}function Bi(e){return function(t,n){if(!oe(t))return!1;if(n){const r=G(t.schema),s=pe(t),i=t.tr,l=s.map.cellsInRect(e=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:e=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),a=l.map(c=>s.table.nodeAt(c));for(let c=0;c<l.length;c++)a[c].type==r.header_cell&&i.setNodeMarkup(s.tableStart+l[c],r.cell,a[c].attrs);if(i.steps.length===0)for(let c=0;c<l.length;c++)i.setNodeMarkup(s.tableStart+l[c],r.header_cell,a[c].attrs);n(i)}return!0}}function xr(e,t,n){const r=t.map.cellsInRect({left:0,top:0,right:e=="row"?t.map.width:1,bottom:e=="column"?t.map.height:1});for(let s=0;s<r.length;s++){const i=t.table.nodeAt(r[s]);if(i&&i.type!==n.header_cell)return!1}return!0}function st(e,t){return t=t||{useDeprecatedLogic:!1},t.useDeprecatedLogic?Bi(e):function(n,r){if(!oe(n))return!1;if(r){const s=G(n.schema),i=pe(n),l=n.tr,a=xr("row",i,s),c=xr("column",i,s),d=(e==="column"?a:e==="row"&&c)?1:0,u=e=="column"?{left:0,top:d,right:1,bottom:i.map.height}:e=="row"?{left:d,top:0,right:i.map.width,bottom:1}:i,p=e=="column"?c?s.cell:s.header_cell:e=="row"?a?s.cell:s.header_cell:s.cell;i.map.cellsInRect(u).forEach(g=>{const h=g+i.tableStart,m=l.doc.nodeAt(h);m&&l.setNodeMarkup(h,p,m.attrs)}),r(l)}return!0}}st("row",{useDeprecatedLogic:!0});st("column",{useDeprecatedLogic:!0});const $i=st("cell",{useDeprecatedLogic:!0});function Wi(e,t){if(t<0){const n=e.nodeBefore;if(n)return e.pos-n.nodeSize;for(let r=e.index(-1)-1,s=e.before();r>=0;r--){const i=e.node(-1).child(r),l=i.lastChild;if(l)return s-1-l.nodeSize;s-=i.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;const n=e.node(-1);for(let r=e.indexAfter(-1),s=e.after();r<n.childCount;r++){const i=n.child(r);if(i.childCount)return s+1;s+=i.nodeSize}}return null}function br(e){return function(t,n){if(!oe(t))return!1;const r=Wi($t(t),e);if(r==null)return!1;if(n){const s=t.doc.resolve(r);n(t.tr.setSelection(ve.between(s,vi(s))).scrollIntoView())}return!0}}function Ui(e,t){const n=e.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return t&&t(e.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}function zt(e,t){const n=e.selection;if(!(n instanceof H))return!1;if(t){const r=e.tr,s=G(e.schema).cell.createAndFill().content;n.forEachCell((i,l)=>{i.content.eq(s)||r.replace(r.mapping.map(l+1),r.mapping.map(l+i.nodeSize-1),new we(s,0,0))}),r.docChanged&&t(r)}return!0}function qi(e){if(e.size===0)return null;let{content:t,openStart:n,openEnd:r}=e;for(;t.childCount==1&&(n>0&&r>0||t.child(0).type.spec.tableRole=="table");)n--,r--,t=t.child(0).content;const s=t.child(0),i=s.type.spec.tableRole,l=s.type.schema,a=[];if(i=="row")for(let c=0;c<t.childCount;c++){let d=t.child(c).content;const u=c?0:Math.max(0,n-1),p=c<t.childCount-1?0:Math.max(0,r-1);(u||p)&&(d=An(G(l).row,new we(d,u,p)).content),a.push(d)}else if(i=="cell"||i=="header_cell")a.push(n||r?An(G(l).row,new we(t,n,r)).content:t);else return null;return Ki(l,a)}function Ki(e,t){const n=[];for(let s=0;s<t.length;s++){const i=t[s];for(let l=i.childCount-1;l>=0;l--){const{rowspan:a,colspan:c}=i.child(l).attrs;for(let d=s;d<s+a;d++)n[d]=(n[d]||0)+c}}let r=0;for(let s=0;s<n.length;s++)r=Math.max(r,n[s]);for(let s=0;s<n.length;s++)if(s>=t.length&&t.push(de.empty),n[s]<r){const i=G(e).cell.createAndFill(),l=[];for(let a=n[s];a<r;a++)l.push(i);t[s]=t[s].append(de.from(l))}return{height:t.length,width:r,rows:t}}function An(e,t){const n=e.createAndFill();return new go(n).replace(0,n.content.size,t).doc}function Vi({width:e,height:t,rows:n},r,s){if(e!=r){const i=[],l=[];for(let a=0;a<n.length;a++){const c=n[a],d=[];for(let u=i[a]||0,p=0;u<r;p++){let g=c.child(p%c.childCount);u+g.attrs.colspan>r&&(g=g.type.createChecked(ze(g.attrs,g.attrs.colspan,u+g.attrs.colspan-r),g.content)),d.push(g),u+=g.attrs.colspan;for(let h=1;h<g.attrs.rowspan;h++)i[a+h]=(i[a+h]||0)+g.attrs.colspan}l.push(de.from(d))}n=l,e=r}if(t!=s){const i=[];for(let l=0,a=0;l<s;l++,a++){const c=[],d=n[a%t];for(let u=0;u<d.childCount;u++){let p=d.child(u);l+p.attrs.rowspan>s&&(p=p.type.create({...p.attrs,rowspan:Math.max(1,s-p.attrs.rowspan)},p.content)),c.push(p)}i.push(de.from(c))}n=i,t=s}return{width:e,height:t,rows:n}}function Gi(e,t,n,r,s,i,l){const a=e.doc.type.schema,c=G(a);let d,u;if(s>t.width)for(let p=0,g=0;p<t.height;p++){const h=n.child(p);g+=h.nodeSize;const m=[];let y;h.lastChild==null||h.lastChild.type==c.cell?y=d||(d=c.cell.createAndFill()):y=u||(u=c.header_cell.createAndFill());for(let b=t.width;b<s;b++)m.push(y);e.insert(e.mapping.slice(l).map(g-1+r),m)}if(i>t.height){const p=[];for(let m=0,y=(t.height-1)*t.width;m<Math.max(t.width,s);m++){const b=m>=t.width?!1:n.nodeAt(t.map[y+m]).type==c.header_cell;p.push(b?u||(u=c.header_cell.createAndFill()):d||(d=c.cell.createAndFill()))}const g=c.row.create(null,de.from(p)),h=[];for(let m=t.height;m<i;m++)h.push(g);e.insert(e.mapping.slice(l).map(r+n.nodeSize-2),h)}return!!(d||u)}function yr(e,t,n,r,s,i,l,a){if(l==0||l==t.height)return!1;let c=!1;for(let d=s;d<i;d++){const u=l*t.width+d,p=t.map[u];if(t.map[u-t.width]==p){c=!0;const g=n.nodeAt(p),{top:h,left:m}=t.findCell(p);e.setNodeMarkup(e.mapping.slice(a).map(p+r),null,{...g.attrs,rowspan:l-h}),e.insert(e.mapping.slice(a).map(t.positionAt(l,m,n)),g.type.createAndFill({...g.attrs,rowspan:h+g.attrs.rowspan-l})),d+=g.attrs.colspan-1}}return c}function vr(e,t,n,r,s,i,l,a){if(l==0||l==t.width)return!1;let c=!1;for(let d=s;d<i;d++){const u=d*t.width+l,p=t.map[u];if(t.map[u-1]==p){c=!0;const g=n.nodeAt(p),h=t.colCount(p),m=e.mapping.slice(a).map(p+r);e.setNodeMarkup(m,null,ze(g.attrs,l-h,g.attrs.colspan-(l-h))),e.insert(m+g.nodeSize,g.type.createAndFill(ze(g.attrs,0,l-h))),d+=g.attrs.rowspan-1}}return c}function wr(e,t,n,r,s){let i=n?e.doc.nodeAt(n-1):e.doc;if(!i)throw new Error("No table found");let l=D.get(i);const{top:a,left:c}=r,d=c+s.width,u=a+s.height,p=e.tr;let g=0;function h(){if(i=n?p.doc.nodeAt(n-1):p.doc,!i)throw new Error("No table found");l=D.get(i),g=p.mapping.maps.length}Gi(p,l,i,n,d,u,g)&&h(),yr(p,l,i,n,c,d,a,g)&&h(),yr(p,l,i,n,c,d,u,g)&&h(),vr(p,l,i,n,a,u,c,g)&&h(),vr(p,l,i,n,a,u,d,g)&&h();for(let m=a;m<u;m++){const y=l.positionAt(m,c,i),b=l.positionAt(m,d,i);p.replace(p.mapping.slice(g).map(y+n),p.mapping.slice(g).map(b+n),new we(s.rows[m-a],0,0))}h(),p.setSelection(new H(p.doc.resolve(n+l.positionAt(a,c,i)),p.doc.resolve(n+l.positionAt(u-1,d-1,i)))),t(p)}const Ji=ho({ArrowLeft:Ot("horiz",-1),ArrowRight:Ot("horiz",1),ArrowUp:Ot("vert",-1),ArrowDown:Ot("vert",1),"Shift-ArrowLeft":_t("horiz",-1),"Shift-ArrowRight":_t("horiz",1),"Shift-ArrowUp":_t("vert",-1),"Shift-ArrowDown":_t("vert",1),Backspace:zt,"Mod-Backspace":zt,Delete:zt,"Mod-Delete":zt});function Ht(e,t,n){return n.eq(e.selection)?!1:(t&&t(e.tr.setSelection(n).scrollIntoView()),!0)}function Ot(e,t){return(n,r,s)=>{if(!s)return!1;const i=n.selection;if(i instanceof H)return Ht(n,r,xe.near(i.$headCell,t));if(e!="horiz"&&!i.empty)return!1;const l=as(s,e,t);if(l==null)return!1;if(e=="horiz")return Ht(n,r,xe.near(n.doc.resolve(i.head+t),t));{const a=n.doc.resolve(l),c=ts(a,e,t);let d;return c?d=xe.near(c,1):t<0?d=xe.near(n.doc.resolve(a.before(-1)),-1):d=xe.near(n.doc.resolve(a.after(-1)),1),Ht(n,r,d)}}}function _t(e,t){return(n,r,s)=>{if(!s)return!1;const i=n.selection;let l;if(i instanceof H)l=i;else{const c=as(s,e,t);if(c==null)return!1;l=new H(n.doc.resolve(c))}const a=ts(l.$headCell,e,t);return a?Ht(n,r,new H(l.$anchorCell,a)):!1}}function Xi(e,t){const n=e.state.doc,r=Te(n.resolve(t));return r?(e.dispatch(e.state.tr.setSelection(new H(r))),!0):!1}function Yi(e,t,n){if(!oe(e.state))return!1;let r=qi(n);const s=e.state.selection;if(s instanceof H){r||(r={width:1,height:1,rows:[de.from(An(G(e.state.schema).cell,n))]});const i=s.$anchorCell.node(-1),l=s.$anchorCell.start(-1),a=D.get(i).rectBetween(s.$anchorCell.pos-l,s.$headCell.pos-l);return r=Vi(r,a.right-a.left,a.bottom-a.top),wr(e.state,e.dispatch,l,a,r),!0}else if(r){const i=$t(e.state),l=i.start(-1);return wr(e.state,e.dispatch,l,D.get(i.node(-1)).findCell(i.pos-l),r),!0}else return!1}function Qi(e,t){var n;if(t.button!=0||t.ctrlKey||t.metaKey)return;const r=Cr(e,t.target);let s;if(t.shiftKey&&e.state.selection instanceof H)i(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&r&&(s=Te(e.state.selection.$anchor))!=null&&((n=gn(e,t))===null||n===void 0?void 0:n.pos)!=s.pos)i(s,t),t.preventDefault();else if(!r)return;function i(c,d){let u=gn(e,d);const p=ye.getState(e.state)==null;if(!u||!Pn(c,u))if(p)u=c;else return;const g=new H(c,u);if(p||!e.state.selection.eq(g)){const h=e.state.tr.setSelection(g);p&&h.setMeta(ye,c.pos),e.dispatch(h)}}function l(){e.root.removeEventListener("mouseup",l),e.root.removeEventListener("dragstart",l),e.root.removeEventListener("mousemove",a),ye.getState(e.state)!=null&&e.dispatch(e.state.tr.setMeta(ye,-1))}function a(c){const d=c,u=ye.getState(e.state);let p;if(u!=null)p=e.state.doc.resolve(u);else if(Cr(e,d.target)!=r&&(p=gn(e,t),!p))return l();p&&i(p,d)}e.root.addEventListener("mouseup",l),e.root.addEventListener("dragstart",l),e.root.addEventListener("mousemove",a)}function as(e,t,n){if(!(e.state.selection instanceof ve))return null;const{$head:r}=e.state.selection;for(let s=r.depth-1;s>=0;s--){const i=r.node(s);if((n<0?r.index(s):r.indexAfter(s))!=(n<0?0:i.childCount))return null;if(i.type.spec.tableRole=="cell"||i.type.spec.tableRole=="header_cell"){const l=r.before(s),a=t=="vert"?n>0?"down":"up":n>0?"right":"left";return e.endOfTextblock(a)?l:null}}return null}function Cr(e,t){for(;t&&t!=e.dom;t=t.parentNode)if(t.nodeName=="TD"||t.nodeName=="TH")return t;return null}function gn(e,t){const n=e.posAtCoords({left:t.clientX,top:t.clientY});if(!n)return null;let{inside:r,pos:s}=n;return r>=0&&Te(e.state.doc.resolve(r))||Te(e.state.doc.resolve(s))}var Zi=class{constructor(t,n){this.node=t,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Tn(t,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!=this.node.type?!1:(this.node=t,Tn(t,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(t){return t.type=="attributes"&&(t.target==this.table||this.colgroup.contains(t.target))}};function Tn(e,t,n,r,s,i){let l=0,a=!0,c=t.firstChild;const d=e.firstChild;if(d){for(let p=0,g=0;p<d.childCount;p++){const{colspan:h,colwidth:m}=d.child(p).attrs;for(let y=0;y<h;y++,g++){const b=s==g?i:m&&m[y],C=b?b+"px":"";if(l+=b||r,b||(a=!1),c)c.style.width!=C&&(c.style.width=C),c=c.nextSibling;else{const T=document.createElement("col");T.style.width=C,t.appendChild(T)}}}for(;c;){var u;const p=c.nextSibling;(u=c.parentNode)===null||u===void 0||u.removeChild(c),c=p}a?(n.style.width=l+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=l+"px")}}const ee=new Hn("tableColumnResizing");function el({handleWidth:e=5,cellMinWidth:t=25,defaultCellMinWidth:n=100,View:r=Zi,lastColumnResizable:s=!0}={}){const i=new Kr({key:ee,state:{init(l,a){var c;const d=(c=i.spec)===null||c===void 0||(c=c.props)===null||c===void 0?void 0:c.nodeViews,u=G(a.schema).table.name;return r&&d&&(d[u]=(p,g)=>new r(p,n,g)),new tl(-1,!1)},apply(l,a){return a.apply(l)}},props:{attributes:l=>{const a=ee.getState(l);return a&&a.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(l,a)=>{nl(l,a,e,s)},mouseleave:l=>{rl(l)},mousedown:(l,a)=>{sl(l,a,t,n)}},decorations:l=>{const a=ee.getState(l);if(a&&a.activeHandle>-1)return cl(l,a.activeHandle)},nodeViews:{}}});return i}var tl=class Pt{constructor(t,n){this.activeHandle=t,this.dragging=n}apply(t){const n=this,r=t.getMeta(ee);if(r&&r.setHandle!=null)return new Pt(r.setHandle,!1);if(r&&r.setDragging!==void 0)return new Pt(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&t.docChanged){let s=t.mapping.map(n.activeHandle,-1);return En(t.doc.resolve(s))||(s=-1),new Pt(s,n.dragging)}return n}};function nl(e,t,n,r){if(!e.editable)return;const s=ee.getState(e.state);if(s&&!s.dragging){const i=il(t.target);let l=-1;if(i){const{left:a,right:c}=i.getBoundingClientRect();t.clientX-a<=n?l=jr(e,t,"left",n):c-t.clientX<=n&&(l=jr(e,t,"right",n))}if(l!=s.activeHandle){if(!r&&l!==-1){const a=e.state.doc.resolve(l),c=a.node(-1),d=D.get(c),u=a.start(-1);if(d.colCount(a.pos-u)+a.nodeAfter.attrs.colspan-1==d.width-1)return}cs(e,l)}}}function rl(e){if(!e.editable)return;const t=ee.getState(e.state);t&&t.activeHandle>-1&&!t.dragging&&cs(e,-1)}function sl(e,t,n,r){var s;if(!e.editable)return!1;const i=(s=e.dom.ownerDocument.defaultView)!==null&&s!==void 0?s:window,l=ee.getState(e.state);if(!l||l.activeHandle==-1||l.dragging)return!1;const a=e.state.doc.nodeAt(l.activeHandle),c=ol(e,l.activeHandle,a.attrs);e.dispatch(e.state.tr.setMeta(ee,{setDragging:{startX:t.clientX,startWidth:c}}));function d(p){i.removeEventListener("mouseup",d),i.removeEventListener("mousemove",u);const g=ee.getState(e.state);g?.dragging&&(ll(e,g.activeHandle,Sr(g.dragging,p,n)),e.dispatch(e.state.tr.setMeta(ee,{setDragging:null})))}function u(p){if(!p.which)return d(p);const g=ee.getState(e.state);if(g&&g.dragging){const h=Sr(g.dragging,p,n);Nr(e,g.activeHandle,h,r)}}return Nr(e,l.activeHandle,c,r),i.addEventListener("mouseup",d),i.addEventListener("mousemove",u),t.preventDefault(),!0}function ol(e,t,{colspan:n,colwidth:r}){const s=r&&r[r.length-1];if(s)return s;const i=e.domAtPos(t);let l=i.node.childNodes[i.offset].offsetWidth,a=n;if(r)for(let c=0;c<n;c++)r[c]&&(l-=r[c],a--);return l/a}function il(e){for(;e&&e.nodeName!="TD"&&e.nodeName!="TH";)e=e.classList&&e.classList.contains("ProseMirror")?null:e.parentNode;return e}function jr(e,t,n,r){const s=n=="right"?-r:r,i=e.posAtCoords({left:t.clientX+s,top:t.clientY});if(!i)return-1;const{pos:l}=i,a=Te(e.state.doc.resolve(l));if(!a)return-1;if(n=="right")return a.pos;const c=D.get(a.node(-1)),d=a.start(-1),u=c.map.indexOf(a.pos-d);return u%c.width==0?-1:d+c.map[u-1]}function Sr(e,t,n){const r=t.clientX-e.startX;return Math.max(n,e.startWidth+r)}function cs(e,t){e.dispatch(e.state.tr.setMeta(ee,{setHandle:t}))}function ll(e,t,n){const r=e.state.doc.resolve(t),s=r.node(-1),i=D.get(s),l=r.start(-1),a=i.colCount(r.pos-l)+r.nodeAfter.attrs.colspan-1,c=e.state.tr;for(let d=0;d<i.height;d++){const u=d*i.width+a;if(d&&i.map[u]==i.map[u-i.width])continue;const p=i.map[u],g=s.nodeAt(p).attrs,h=g.colspan==1?0:a-i.colCount(p);if(g.colwidth&&g.colwidth[h]==n)continue;const m=g.colwidth?g.colwidth.slice():al(g.colspan);m[h]=n,c.setNodeMarkup(l+p,null,{...g,colwidth:m})}c.docChanged&&e.dispatch(c)}function Nr(e,t,n,r){const s=e.state.doc.resolve(t),i=s.node(-1),l=s.start(-1),a=D.get(i).colCount(s.pos-l)+s.nodeAfter.attrs.colspan-1;let c=e.domAtPos(s.start(-1)).node;for(;c&&c.nodeName!="TABLE";)c=c.parentNode;c&&Tn(i,c.firstChild,c,r,a,n)}function al(e){return Array(e).fill(0)}function cl(e,t){const n=[],r=e.doc.resolve(t),s=r.node(-1);if(!s)return vn.empty;const i=D.get(s),l=r.start(-1),a=i.colCount(r.pos-l)+r.nodeAfter.attrs.colspan-1;for(let d=0;d<i.height;d++){const u=a+d*i.width;if((a==i.width-1||i.map[u]!=i.map[u+1])&&(d==0||i.map[u]!=i.map[u-i.width])){var c;const p=i.map[u],g=l+p+s.nodeAt(p).nodeSize-1,h=document.createElement("div");h.className="column-resize-handle",!((c=ee.getState(e))===null||c===void 0)&&c.dragging&&n.push(wn.node(l+p,l+p+s.nodeAt(p).nodeSize,{class:"column-resize-dragging"})),n.push(wn.widget(g,h))}}return vn.create(e.doc,n)}function dl({allowTableNodeSelection:e=!1}={}){return new Kr({key:ye,state:{init(){return null},apply(t,n){const r=t.getMeta(ye);if(r!=null)return r==-1?null:r;if(n==null||!t.docChanged)return n;const{deleted:s,pos:i}=t.mapping.mapResult(n);return s?null:i}},props:{decorations:ji,handleDOMEvents:{mousedown:Qi},createSelectionBetween(t){return ye.getState(t.state)!=null?t.state.selection:null},handleTripleClick:Xi,handleKeyDown:Ji,handlePaste:Yi},appendTransaction(t,n,r){return ki(r,os(r,n),e)}})}var ds=ot.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{var t,n;const r=e.getAttribute("colwidth"),s=r?r.split(",").map(i=>parseInt(i,10)):null;if(!s){const i=(t=e.closest("table"))==null?void 0:t.querySelectorAll("colgroup > col"),l=Array.from(((n=e.parentElement)==null?void 0:n.children)||[]).indexOf(e);if(l&&l>-1&&i&&i[l]){const a=i[l].getAttribute("width");return a?[parseInt(a,10)]:null}}return s}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:e}){return["td",_e(this.options.HTMLAttributes,e),0]}}),us=ot.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?t.split(",").map(r=>parseInt(r,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:e}){return["th",_e(this.options.HTMLAttributes,e),0]}}),ps=ot.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:e}){return["tr",_e(this.options.HTMLAttributes,e),0]}});function zn(e,t){return t?["width",`${Math.max(t,e)}px`]:["min-width",`${e}px`]}function kr(e,t,n,r,s,i){var l;let a=0,c=!0,d=t.firstChild;const u=e.firstChild;if(u!==null)for(let g=0,h=0;g<u.childCount;g+=1){const{colspan:m,colwidth:y}=u.child(g).attrs;for(let b=0;b<m;b+=1,h+=1){const C=s===h?i:y&&y[b],T=C?`${C}px`:"";if(a+=C||r,C||(c=!1),d){if(d.style.width!==T){const[R,z]=zn(r,C);d.style.setProperty(R,z)}d=d.nextSibling}else{const R=document.createElement("col"),[z,E]=zn(r,C);R.style.setProperty(z,E),t.appendChild(R)}}}for(;d;){const g=d.nextSibling;(l=d.parentNode)==null||l.removeChild(d),d=g}const p=e.attrs.style&&typeof e.attrs.style=="string"&&/\bwidth\s*:/i.test(e.attrs.style);c&&!p?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}var ul=class{constructor(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),e.attrs.style&&(this.table.style.cssText=e.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),kr(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!==this.node.type?!1:(this.node=e,kr(e,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(e){const t=e.target,n=this.dom.contains(t),r=this.contentDOM.contains(t);return!!(n&&!r&&(e.type==="attributes"||e.type==="childList"||e.type==="characterData"))}};function pl(e,t,n,r){let s=0,i=!0;const l=[],a=e.firstChild;if(!a)return{};for(let p=0,g=0;p<a.childCount;p+=1){const{colspan:h,colwidth:m}=a.child(p).attrs;for(let y=0;y<h;y+=1,g+=1){const b=n===g?r:m&&m[y];s+=b||t,b||(i=!1);const[C,T]=zn(t,b);l.push(["col",{style:`${C}: ${T}`}])}}const c=i?`${s}px`:"",d=i?"":`${s}px`;return{colgroup:["colgroup",{},...l],tableWidth:c,tableMinWidth:d}}function Rr(e,t){return e.createAndFill()}function fl(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach(n=>{const r=e.nodes[n];r.spec.tableRole&&(t[r.spec.tableRole]=r)}),e.cached.tableNodeTypes=t,t}function hl(e,t,n,r,s){const i=fl(e),l=[],a=[];for(let d=0;d<n;d+=1){const u=Rr(i.cell);if(u&&a.push(u),r){const p=Rr(i.header_cell);p&&l.push(p)}}const c=[];for(let d=0;d<t;d+=1)c.push(i.row.createChecked(null,r&&d===0?l:a));return i.table.createChecked(null,c)}function ml(e){return e instanceof H}var Mt=({editor:e})=>{const{selection:t}=e.state;if(!ml(t))return!1;let n=0;const r=yo(t.ranges[0].$from,i=>i.type.name==="table");return r?.node.descendants(i=>{if(i.type.name==="table")return!1;["tableCell","tableHeader"].includes(i.type.name)&&(n+=1)}),n===t.ranges.length?(e.commands.deleteTable(),!0):!1},gl="";function xl(e){return(e||"").replace(/\s+/g," ").trim()}function bl(e,t,n={}){var r;const s=(r=n.cellLineSeparator)!=null?r:gl;if(!e||!e.content||e.content.length===0)return"";const i=[];e.content.forEach(m=>{const y=[];m.content&&m.content.forEach(b=>{let C="";b.content&&Array.isArray(b.content)&&b.content.length>1?C=b.content.map(E=>t.renderChildren(E)).join(s):C=b.content?t.renderChildren(b.content):"";const T=xl(C),R=b.type==="tableHeader";y.push({text:T,isHeader:R})}),i.push(y)});const l=i.reduce((m,y)=>Math.max(m,y.length),0);if(l===0)return"";const a=new Array(l).fill(0);i.forEach(m=>{var y;for(let b=0;b<l;b+=1){const T=(((y=m[b])==null?void 0:y.text)||"").length;T>a[b]&&(a[b]=T),a[b]<3&&(a[b]=3)}});const c=(m,y)=>m+" ".repeat(Math.max(0,y-m.length)),d=i[0],u=d.some(m=>m.isHeader);let p=`
`;const g=new Array(l).fill(0).map((m,y)=>u&&d[y]&&d[y].text||"");return p+=`| ${g.map((m,y)=>c(m,a[y])).join(" | ")} |
`,p+=`| ${a.map(m=>"-".repeat(Math.max(3,m))).join(" | ")} |
`,(u?i.slice(1):i).forEach(m=>{p+=`| ${new Array(l).fill(0).map((y,b)=>c(m[b]&&m[b].text||"",a[b])).join(" | ")} |
`}),p}var yl=bl,fs=ot.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:ul,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:e,HTMLAttributes:t}){const{colgroup:n,tableWidth:r,tableMinWidth:s}=pl(e,this.options.cellMinWidth),i=t.style;function l(){return i||(r?`width: ${r}`:`min-width: ${s}`)}const a=["table",_e(this.options.HTMLAttributes,t,{style:l()}),n,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},a]:a},parseMarkdown:(e,t)=>{const n=[];if(e.header){const r=[];e.header.forEach(s=>{r.push(t.createNode("tableHeader",{},[{type:"paragraph",content:t.parseInline(s.tokens)}]))}),n.push(t.createNode("tableRow",{},r))}return e.rows&&e.rows.forEach(r=>{const s=[];r.forEach(i=>{s.push(t.createNode("tableCell",{},[{type:"paragraph",content:t.parseInline(i.tokens)}]))}),n.push(t.createNode("tableRow",{},s))}),t.createNode("table",void 0,n)},renderMarkdown:(e,t)=>yl(e,t),addCommands(){return{insertTable:({rows:e=3,cols:t=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:s,editor:i})=>{const l=hl(i.schema,e,t,n);if(s){const a=r.selection.from+1;r.replaceSelectionWith(l).scrollIntoView().setSelection(ve.near(r.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:e,dispatch:t})=>Ai(e,t),addColumnAfter:()=>({state:e,dispatch:t})=>Ti(e,t),deleteColumn:()=>({state:e,dispatch:t})=>Oi(e,t),addRowBefore:()=>({state:e,dispatch:t})=>Mi(e,t),addRowAfter:()=>({state:e,dispatch:t})=>Li(e,t),deleteRow:()=>({state:e,dispatch:t})=>Pi(e,t),deleteTable:()=>({state:e,dispatch:t})=>Ui(e,t),mergeCells:()=>({state:e,dispatch:t})=>mr(e,t),splitCell:()=>({state:e,dispatch:t})=>gr(e,t),toggleHeaderColumn:()=>({state:e,dispatch:t})=>st("column")(e,t),toggleHeaderRow:()=>({state:e,dispatch:t})=>st("row")(e,t),toggleHeaderCell:()=>({state:e,dispatch:t})=>$i(e,t),mergeOrSplit:()=>({state:e,dispatch:t})=>mr(e,t)?!0:gr(e,t),setCellAttribute:(e,t)=>({state:n,dispatch:r})=>Fi(e,t)(n,r),goToNextCell:()=>({state:e,dispatch:t})=>br(1)(e,t),goToPreviousCell:()=>({state:e,dispatch:t})=>br(-1)(e,t),fixTables:()=>({state:e,dispatch:t})=>(t&&os(e),!0),setCellSelection:e=>({tr:t,dispatch:n})=>{if(n){const r=H.create(t.doc,e.anchorCell,e.headCell);t.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:Mt,"Mod-Backspace":Mt,Delete:Mt,"Mod-Delete":Mt}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[el({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],dl({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(e){const t={name:e.name,options:e.options,storage:e.storage};return{tableRole:xo(bo(e,"tableRole",t))}}});ue.create({name:"tableKit",addExtensions(){const e=[];return this.options.table!==!1&&e.push(fs.configure(this.options.table)),this.options.tableCell!==!1&&e.push(ds.configure(this.options.tableCell)),this.options.tableHeader!==!1&&e.push(us.configure(this.options.tableHeader)),this.options.tableRow!==!1&&e.push(ps.configure(this.options.tableRow)),e}});const vl=ue.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:e=>e.style.fontSize.replace(/['"]+/g,""),renderHTML:e=>e.fontSize?{style:`font-size: ${e.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:e=>({chain:t})=>t().setMark("textStyle",{fontSize:e}).run(),unsetFontSize:()=>({chain:e})=>e().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),wl=ue.create({name:"lineHeight",addOptions(){return{types:["paragraph","heading"],defaultLineHeight:"normal"}},addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:this.options.defaultLineHeight,parseHTML:e=>e.style.lineHeight||this.options.defaultLineHeight,renderHTML:e=>e.lineHeight===this.options.defaultLineHeight?{}:{style:`line-height: ${e.lineHeight}`}}}}]},addCommands(){return{setLineHeight:e=>({commands:t})=>this.options.types.every(n=>t.updateAttributes(n,{lineHeight:e})),unsetLineHeight:()=>({commands:e})=>this.options.types.every(t=>e.resetAttributes(t,"lineHeight"))}}}),Er=({content:e,onUpdate:t,onFocus:n,onCreated:r,editable:s,className:i,placeholder:l,style:a})=>{const c=vo({extensions:[jo.configure({heading:!1}),So.configure({levels:[1,2,3,4]}),wo,Qr,es,vl,wl,Zr,ai.configure({types:["heading","paragraph"]}),ui.configure({multicolor:!0}),Co,No.configure({nested:!0}),fi.configure({inline:!0,allowBase64:!0}),fs.configure({resizable:!0}),ps,us,ds,ko.configure({placeholder:l||" ..."})],content:e,editable:s,onUpdate:({editor:d})=>{t(d.getHTML())},onFocus:({editor:d})=>{n(d)},onCreate:({editor:d})=>{r&&r(d)}});return v.useEffect(()=>{if(!c)return;!(c.getHTML()===e)&&!c.isFocused&&c.commands.setContent(e,{emitUpdate:!1})},[e,c]),v.useEffect(()=>{c&&c.setEditable(s)},[s,c]),o.jsx(Ro,{editor:c,className:i,style:a,onMouseUp:()=>{}})},Cl=({editor:e,onOpenSettings:t})=>{const[,n]=pn.useReducer(l=>l+1,0);pn.useEffect(()=>{if(!e)return;const l=()=>n();return e.on("transaction",l),e.on("selectionUpdate",l),()=>{e.off("transaction",l),e.off("selectionUpdate",l)}},[e]);const[r,s]=pn.useState(""),i=()=>{r&&window.find(r)};return o.jsxs("div",{className:"novel-toolbar author-toolbar",children:[o.jsxs("div",{className:"group",children:[o.jsx("button",{onClick:()=>e?.chain().focus().undo().run(),disabled:!e?.can().undo(),title:"",children:o.jsx("span",{className:"material-symbols-outlined",children:"undo"})}),o.jsx("button",{onClick:()=>e?.chain().focus().redo().run(),disabled:!e?.can().redo(),title:" ",children:o.jsx("span",{className:"material-symbols-outlined",children:"redo"})})]}),o.jsx("div",{className:"separator"}),o.jsxs("select",{onChange:l=>{if(!e)return;const a=l.target.value;a==="p"?e.chain().focus().setParagraph().run():e.chain().focus().toggleHeading({level:parseInt(a)}).run()},value:e?.isActive("heading",{level:1})?"1":e?.isActive("heading",{level:2})?"2":e?.isActive("heading",{level:3})?"3":e?.isActive("heading",{level:4})?"4":"p",disabled:!e,className:"style-select",children:[o.jsx("option",{value:"p",children:""}),o.jsx("option",{value:"1",children:" 1"}),o.jsx("option",{value:"2",children:" 2"}),o.jsx("option",{value:"3",children:" 1"}),o.jsx("option",{value:"4",children:" 2"})]}),o.jsx("div",{className:"separator"}),o.jsxs("select",{onChange:l=>{e&&e.chain().focus().setFontFamily(l.target.value).run()},value:e?.getAttributes("textStyle").fontFamily||"",disabled:!e,className:"font-select",children:[o.jsx("option",{value:"",children:" "}),o.jsx("option",{value:"Inter",children:"Inter"}),o.jsx("option",{value:"Roboto",children:"Roboto"}),o.jsx("option",{value:"Pretendard",children:"Pretendard"}),o.jsx("option",{value:"Nanum Myeongjo",children:""}),o.jsx("option",{value:"serif",children:"Serif"}),o.jsx("option",{value:"monospace",children:"Monospace"})]}),o.jsx("select",{onChange:l=>{e&&e.chain().focus().setFontSize(l.target.value).run()},value:e?.getAttributes("textStyle").fontSize||"16px",disabled:!e,className:"size-select",children:[12,14,16,18,20,24,30,36].map(l=>o.jsxs("option",{value:`${l}px`,children:[l,"px"]},l))}),o.jsx("div",{className:"separator"}),o.jsxs("div",{className:"group",children:[o.jsx("button",{onClick:()=>e?.chain().focus().toggleBold().run(),className:e?.isActive("bold")?"is-active":"",title:"",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_bold"})}),o.jsx("button",{onClick:()=>e?.chain().focus().toggleItalic().run(),className:e?.isActive("italic")?"is-active":"",title:"",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_italic"})}),o.jsx("button",{onClick:()=>e?.chain().focus().toggleUnderline().run(),className:e?.isActive("underline")?"is-active":"",title:"",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_underlined"})}),o.jsx("button",{onClick:()=>e?.chain().focus().toggleStrike().run(),className:e?.isActive("strike")?"is-active":"",title:"",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_strikethrough"})}),o.jsxs("div",{className:"color-picker-wrapper",title:" ",children:[o.jsx("span",{className:"material-symbols-outlined",children:"format_color_text"}),o.jsx("input",{type:"color",onChange:l=>e?.chain().focus().setColor(l.target.value).run(),value:e?.getAttributes("textStyle").color||"var(--foreground)",disabled:!e})]})]}),o.jsx("div",{className:"separator"}),o.jsxs("div",{className:"group",children:[o.jsx("button",{onClick:()=>e?.chain().focus().setTextAlign("left").run(),className:e?.isActive({textAlign:"left"})?"is-active":"",title:" ",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_align_left"})}),o.jsx("button",{onClick:()=>e?.chain().focus().setTextAlign("center").run(),className:e?.isActive({textAlign:"center"})?"is-active":"",title:" ",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_align_center"})}),o.jsx("button",{onClick:()=>e?.chain().focus().setTextAlign("right").run(),className:e?.isActive({textAlign:"right"})?"is-active":"",title:" ",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_align_right"})}),o.jsx("button",{onClick:()=>e?.chain().focus().setTextAlign("justify").run(),className:e?.isActive({textAlign:"justify"})?"is-active":"",title:" ",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_align_justify"})})]}),o.jsx("div",{className:"separator"}),o.jsx("div",{className:"group",children:o.jsxs("select",{onChange:l=>{e&&e.chain().focus().setLineHeight(l.target.value).run()},value:e?.getAttributes("paragraph").lineHeight||"normal",disabled:!e,className:"spacing-select",title:"   ",children:[o.jsx("option",{value:"normal",children:" "}),o.jsx("option",{value:"1.0",children:"1.0"}),o.jsx("option",{value:"1.2",children:"1.2"}),o.jsx("option",{value:"1.5",children:"1.5"}),o.jsx("option",{value:"2.0",children:"2.0"}),o.jsx("option",{value:"2.5",children:"2.5"}),o.jsx("option",{value:"3.0",children:"3.0"})]})}),o.jsx("div",{className:"separator"}),o.jsxs("div",{className:"group",children:[o.jsx("button",{onClick:()=>e?.chain().focus().toggleBulletList().run(),className:e?.isActive("bulletList")?"is-active":"",title:"",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_list_bulleted"})}),o.jsx("button",{onClick:()=>e?.chain().focus().toggleOrderedList().run(),className:e?.isActive("orderedList")?"is-active":"",title:"",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"format_list_numbered"})}),o.jsx("button",{onClick:()=>e?.chain().focus().toggleTaskList().run(),className:e?.isActive("taskList")?"is-active":"",title:"",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"checklist"})})]}),o.jsx("div",{className:"separator"}),o.jsxs("div",{className:"group",children:[o.jsx("button",{onClick:()=>{const l=window.prompt(" URL ");l&&e?.chain().focus().setImage({src:l}).run()},title:" ",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"add_photo_alternate"})}),o.jsx("button",{onClick:()=>e?.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run(),title:" ",disabled:!e,children:o.jsx("span",{className:"material-symbols-outlined",children:"grid_on"})}),o.jsxs("div",{className:"color-picker-wrapper",title:"  ()",children:[o.jsx("span",{className:"material-symbols-outlined",children:"label"}),o.jsx("input",{type:"color",onChange:l=>e?.chain().focus().setHighlight({color:l.target.value}).run(),value:e?.getAttributes("highlight").color||"#ffff00",disabled:!e})]})]}),o.jsx("div",{className:"separator"}),o.jsxs("div",{className:"search-group",children:[o.jsx("input",{type:"text",placeholder:"...",value:r,onChange:l=>s(l.target.value),onKeyDown:l=>l.key==="Enter"&&i(),disabled:!e}),o.jsx("button",{onClick:i,disabled:!e,title:"",children:o.jsx("span",{className:"material-symbols-outlined",children:"search"})})]}),o.jsx("div",{className:"separator"}),o.jsx("div",{className:"group",children:o.jsx("button",{onClick:t,className:"settings-btn",title:"",style:{display:"flex",alignItems:"center",justifyContent:"center",color:"var(--foreground)",padding:"6px"},children:o.jsx(Vr,{size:20})})})]})},jl=({editor:e,readerSettings:t,onSettingsChange:n,onBookmark:r,onHighlight:s,onAddMemo:i})=>{const[l,a]=v.useState(null),c=v.useRef(null);v.useEffect(()=>{const h=m=>{c.current&&!c.current.contains(m.target)&&a(null)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]);const d=h=>{a(l===h?null:h)},u=()=>{n({fontSize:18,lineHeight:2,paragraphSpacing:40,contentWidth:80,fontFamily:"Noto Sans KR",theme:"light"}),a(null)},p=[{name:"Noto Sans KR",label:"  (Sans)"},{name:"Noto Serif KR",label:"  (Serif)"},{name:"Nanum Myeongjo",label:" "},{name:"Nanum Gothic",label:" "},{name:"Poppins",label:"Poppins"},{name:"Inter",label:"Inter"}],g=[{id:"light",label:"",color:"#ffffff",textColor:"#1c1917"},{id:"sepia",label:"",color:"#ede0d4",textColor:"#311900"},{id:"dark",label:"",color:"#1a1a1a",textColor:"#ffffff"}];return o.jsx("div",{className:"novel-toolbar reader-toolbar",ref:c,children:o.jsxs("div",{className:"group",children:[o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{onClick:()=>d("typography"),className:`toolbar-btn ${l==="typography"?"active":""}`,title:" ",children:o.jsx(Eo,{size:20})}),l==="typography"&&o.jsxs("div",{className:"reader-popover",children:[o.jsx("div",{className:"popover-header",children:" "}),o.jsxs("div",{className:"popover-row",children:[o.jsx("button",{className:"popover-btn-small",onClick:()=>n({...t,fontSize:Math.max(12,t.fontSize-1)}),children:o.jsx(Ao,{size:16})}),o.jsx("span",{style:{minWidth:"30px",textAlign:"center",fontWeight:600},children:t.fontSize}),o.jsx("button",{className:"popover-btn-small",onClick:()=>n({...t,fontSize:Math.min(32,t.fontSize+1)}),children:o.jsx(To,{size:16})}),o.jsx("button",{className:"popover-btn-reset",onClick:u,children:""})]})]})]}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{onClick:()=>d("font"),className:`toolbar-btn ${l==="font"?"active":""}`,title:" ",children:o.jsx("span",{style:{fontSize:"18px",fontWeight:700},children:"A"})}),l==="font"&&o.jsxs("div",{className:"reader-popover",children:[o.jsx("div",{className:"popover-header",children:""}),p.map(h=>o.jsxs("div",{className:`popover-item ${t.fontFamily===h.name?"selected":""}`,onClick:()=>{n({...t,fontFamily:h.name}),a(null)},children:[o.jsx("span",{style:{fontFamily:h.name},children:h.label}),t.fontFamily===h.name&&o.jsx(Et,{size:14})]},h.name))]})]}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{onClick:()=>d("theme"),className:`toolbar-btn ${l==="theme"?"active":""}`,title:" ",children:o.jsx(zo,{size:20})}),l==="theme"&&o.jsxs("div",{className:"reader-popover",children:[o.jsx("div",{className:"popover-header",children:""}),g.map(h=>o.jsxs("div",{className:`popover-item ${t.theme===h.id?"selected":""}`,onClick:()=>{n({...t,theme:h.id}),a(null)},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:h.color,border:"1px solid #e2e8f0"}}),h.label]}),t.theme===h.id&&o.jsx(Et,{size:14})]},h.id))]})]}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{onClick:()=>d("spacing"),className:`toolbar-btn ${l==="spacing"?"active":""}`,title:" ",children:o.jsx(lr,{size:20})}),l==="spacing"&&o.jsxs("div",{className:"reader-popover",children:[o.jsx("div",{className:"popover-header",children:" "}),[{val:1.5,label:""},{val:2,label:""},{val:2.5,label:" "}].map(h=>o.jsxs("div",{className:`popover-item ${t.lineHeight===h.val?"selected":""}`,onClick:()=>{n({...t,lineHeight:h.val}),a(null)},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx(lr,{size:14,style:{opacity:.5}}),h.label]}),t.lineHeight===h.val&&o.jsx(Et,{size:14})]},h.val))]})]}),o.jsxs("div",{style:{position:"relative"},children:[o.jsx("button",{onClick:()=>d("width"),className:`toolbar-btn ${l==="width"?"active":""}`,title:" ",children:o.jsx(Oo,{size:20})}),l==="width"&&o.jsxs("div",{className:"reader-popover",children:[o.jsx("div",{className:"popover-header",children:" "}),[{val:70,label:""},{val:80,label:""},{val:90,label:""},{val:100,label:""}].map(h=>o.jsxs("div",{className:`popover-item ${t.contentWidth===h.val?"selected":""}`,onClick:()=>{n({...t,contentWidth:h.val}),a(null)},children:[o.jsxs("span",{children:[h.label," (",h.val,"%)"]}),t.contentWidth===h.val&&o.jsx(Et,{size:14})]},h.val))]})]}),o.jsx("div",{className:"separator",style:{margin:"0 8px"}}),o.jsx("button",{onClick:r,title:" ",className:"toolbar-btn",children:o.jsx(_o,{size:20})}),o.jsx("button",{onClick:s,disabled:!e,title:"",className:"toolbar-btn",children:o.jsx(Mo,{size:20})}),o.jsx("button",{onClick:i,disabled:!e,title:" ",className:"toolbar-btn",children:o.jsx(Lo,{size:20})})]})})};function hs(e,t){return function(){return e.apply(t,arguments)}}const{toString:Sl}=Object.prototype,{getPrototypeOf:In}=Object,{iterator:Wt,toStringTag:ms}=Symbol,Ut=(e=>t=>{const n=Sl.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),ie=e=>(e=e.toLowerCase(),t=>Ut(t)===e),qt=e=>t=>typeof t===e,{isArray:qe}=Array,Ue=qt("undefined");function lt(e){return e!==null&&!Ue(e)&&e.constructor!==null&&!Ue(e.constructor)&&Y(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const gs=ie("ArrayBuffer");function Nl(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&gs(e.buffer),t}const kl=qt("string"),Y=qt("function"),xs=qt("number"),at=e=>e!==null&&typeof e=="object",Rl=e=>e===!0||e===!1,It=e=>{if(Ut(e)!=="object")return!1;const t=In(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(ms in e)&&!(Wt in e)},El=e=>{if(!at(e)||lt(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},Al=ie("Date"),Tl=ie("File"),zl=ie("Blob"),Ol=ie("FileList"),_l=e=>at(e)&&Y(e.pipe),Ml=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Y(e.append)&&((t=Ut(e))==="formdata"||t==="object"&&Y(e.toString)&&e.toString()==="[object FormData]"))},Ll=ie("URLSearchParams"),[Hl,Pl,Il,Dl]=["ReadableStream","Request","Response","Headers"].map(ie),Fl=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ct(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let r,s;if(typeof e!="object"&&(e=[e]),qe(e))for(r=0,s=e.length;r<s;r++)t.call(null,e[r],r,e);else{if(lt(e))return;const i=n?Object.getOwnPropertyNames(e):Object.keys(e),l=i.length;let a;for(r=0;r<l;r++)a=i[r],t.call(null,e[a],a,e)}}function bs(e,t){if(lt(e))return null;t=t.toLowerCase();const n=Object.keys(e);let r=n.length,s;for(;r-- >0;)if(s=n[r],t===s.toLowerCase())return s;return null}const Ee=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ys=e=>!Ue(e)&&e!==Ee;function On(){const{caseless:e,skipUndefined:t}=ys(this)&&this||{},n={},r=(s,i)=>{if(i==="__proto__"||i==="constructor"||i==="prototype")return;const l=e&&bs(n,i)||i;It(n[l])&&It(s)?n[l]=On(n[l],s):It(s)?n[l]=On({},s):qe(s)?n[l]=s.slice():(!t||!Ue(s))&&(n[l]=s)};for(let s=0,i=arguments.length;s<i;s++)arguments[s]&&ct(arguments[s],r);return n}const Bl=(e,t,n,{allOwnKeys:r}={})=>(ct(t,(s,i)=>{n&&Y(s)?Object.defineProperty(e,i,{value:hs(s,n),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(e,i,{value:s,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:r}),e),$l=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),Wl=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},Ul=(e,t,n,r)=>{let s,i,l;const a={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)l=s[i],(!r||r(l,e,t))&&!a[l]&&(t[l]=e[l],a[l]=!0);e=n!==!1&&In(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},ql=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},Kl=e=>{if(!e)return null;if(qe(e))return e;let t=e.length;if(!xs(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},Vl=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&In(Uint8Array)),Gl=(e,t)=>{const r=(e&&e[Wt]).call(e);let s;for(;(s=r.next())&&!s.done;){const i=s.value;t.call(e,i[0],i[1])}},Jl=(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},Xl=ie("HTMLFormElement"),Yl=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,s){return r.toUpperCase()+s}),Ar=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Ql=ie("RegExp"),vs=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};ct(n,(s,i)=>{let l;(l=t(s,i,e))!==!1&&(r[i]=l||s)}),Object.defineProperties(e,r)},Zl=e=>{vs(e,(t,n)=>{if(Y(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];if(Y(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},ea=(e,t)=>{const n={},r=s=>{s.forEach(i=>{n[i]=!0})};return qe(e)?r(e):r(String(e).split(t)),n},ta=()=>{},na=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function ra(e){return!!(e&&Y(e.append)&&e[ms]==="FormData"&&e[Wt])}const sa=e=>{const t=new Array(10),n=(r,s)=>{if(at(r)){if(t.indexOf(r)>=0)return;if(lt(r))return r;if(!("toJSON"in r)){t[s]=r;const i=qe(r)?[]:{};return ct(r,(l,a)=>{const c=n(l,s+1);!Ue(c)&&(i[a]=c)}),t[s]=void 0,i}}return r};return n(e,0)},oa=ie("AsyncFunction"),ia=e=>e&&(at(e)||Y(e))&&Y(e.then)&&Y(e.catch),ws=((e,t)=>e?setImmediate:t?((n,r)=>(Ee.addEventListener("message",({source:s,data:i})=>{s===Ee&&i===n&&r.length&&r.shift()()},!1),s=>{r.push(s),Ee.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Y(Ee.postMessage)),la=typeof queueMicrotask<"u"?queueMicrotask.bind(Ee):typeof process<"u"&&process.nextTick||ws,aa=e=>e!=null&&Y(e[Wt]),x={isArray:qe,isArrayBuffer:gs,isBuffer:lt,isFormData:Ml,isArrayBufferView:Nl,isString:kl,isNumber:xs,isBoolean:Rl,isObject:at,isPlainObject:It,isEmptyObject:El,isReadableStream:Hl,isRequest:Pl,isResponse:Il,isHeaders:Dl,isUndefined:Ue,isDate:Al,isFile:Tl,isBlob:zl,isRegExp:Ql,isFunction:Y,isStream:_l,isURLSearchParams:Ll,isTypedArray:Vl,isFileList:Ol,forEach:ct,merge:On,extend:Bl,trim:Fl,stripBOM:$l,inherits:Wl,toFlatObject:Ul,kindOf:Ut,kindOfTest:ie,endsWith:ql,toArray:Kl,forEachEntry:Gl,matchAll:Jl,isHTMLForm:Xl,hasOwnProperty:Ar,hasOwnProp:Ar,reduceDescriptors:vs,freezeMethods:Zl,toObjectSet:ea,toCamelCase:Yl,noop:ta,toFiniteNumber:na,findKey:bs,global:Ee,isContextDefined:ys,isSpecCompliantForm:ra,toJSONObject:sa,isAsyncFn:oa,isThenable:ia,setImmediate:ws,asap:la,isIterable:aa};let N=class Cs extends Error{static from(t,n,r,s,i,l){const a=new Cs(t.message,n||t.code,r,s,i);return a.cause=t,a.name=t.name,l&&Object.assign(a,l),a}constructor(t,n,r,s,i){super(t),this.name="AxiosError",this.isAxiosError=!0,n&&(this.code=n),r&&(this.config=r),s&&(this.request=s),i&&(this.response=i,this.status=i.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:x.toJSONObject(this.config),code:this.code,status:this.status}}};N.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";N.ERR_BAD_OPTION="ERR_BAD_OPTION";N.ECONNABORTED="ECONNABORTED";N.ETIMEDOUT="ETIMEDOUT";N.ERR_NETWORK="ERR_NETWORK";N.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";N.ERR_DEPRECATED="ERR_DEPRECATED";N.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";N.ERR_BAD_REQUEST="ERR_BAD_REQUEST";N.ERR_CANCELED="ERR_CANCELED";N.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";N.ERR_INVALID_URL="ERR_INVALID_URL";const ca=null;function _n(e){return x.isPlainObject(e)||x.isArray(e)}function js(e){return x.endsWith(e,"[]")?e.slice(0,-2):e}function Tr(e,t,n){return e?e.concat(t).map(function(s,i){return s=js(s),!n&&i?"["+s+"]":s}).join(n?".":""):t}function da(e){return x.isArray(e)&&!e.some(_n)}const ua=x.toFlatObject(x,{},null,function(t){return/^is[A-Z]/.test(t)});function Kt(e,t,n){if(!x.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=x.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,b){return!x.isUndefined(b[y])});const r=n.metaTokens,s=n.visitor||u,i=n.dots,l=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&x.isSpecCompliantForm(t);if(!x.isFunction(s))throw new TypeError("visitor must be a function");function d(m){if(m===null)return"";if(x.isDate(m))return m.toISOString();if(x.isBoolean(m))return m.toString();if(!c&&x.isBlob(m))throw new N("Blob is not supported. Use a Buffer instead.");return x.isArrayBuffer(m)||x.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,y,b){let C=m;if(m&&!b&&typeof m=="object"){if(x.endsWith(y,"{}"))y=r?y:y.slice(0,-2),m=JSON.stringify(m);else if(x.isArray(m)&&da(m)||(x.isFileList(m)||x.endsWith(y,"[]"))&&(C=x.toArray(m)))return y=js(y),C.forEach(function(R,z){!(x.isUndefined(R)||R===null)&&t.append(l===!0?Tr([y],z,i):l===null?y:y+"[]",d(R))}),!1}return _n(m)?!0:(t.append(Tr(b,y,i),d(m)),!1)}const p=[],g=Object.assign(ua,{defaultVisitor:u,convertValue:d,isVisitable:_n});function h(m,y){if(!x.isUndefined(m)){if(p.indexOf(m)!==-1)throw Error("Circular reference detected in "+y.join("."));p.push(m),x.forEach(m,function(C,T){(!(x.isUndefined(C)||C===null)&&s.call(t,C,x.isString(T)?T.trim():T,y,g))===!0&&h(C,y?y.concat(T):[T])}),p.pop()}}if(!x.isObject(e))throw new TypeError("data must be an object");return h(e),t}function zr(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function Dn(e,t){this._pairs=[],e&&Kt(e,this,t)}const Ss=Dn.prototype;Ss.append=function(t,n){this._pairs.push([t,n])};Ss.toString=function(t){const n=t?function(r){return t.call(this,r,zr)}:zr;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function pa(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Ns(e,t,n){if(!t)return e;const r=n&&n.encode||pa,s=x.isFunction(n)?{serialize:n}:n,i=s&&s.serialize;let l;if(i?l=i(t,s):l=x.isURLSearchParams(t)?t.toString():new Dn(t,s).toString(r),l){const a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}class Or{constructor(){this.handlers=[]}use(t,n,r){return this.handlers.push({fulfilled:t,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){x.forEach(this.handlers,function(r){r!==null&&t(r)})}}const Fn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},fa=typeof URLSearchParams<"u"?URLSearchParams:Dn,ha=typeof FormData<"u"?FormData:null,ma=typeof Blob<"u"?Blob:null,ga={isBrowser:!0,classes:{URLSearchParams:fa,FormData:ha,Blob:ma},protocols:["http","https","file","blob","url","data"]},Bn=typeof window<"u"&&typeof document<"u",Mn=typeof navigator=="object"&&navigator||void 0,xa=Bn&&(!Mn||["ReactNative","NativeScript","NS"].indexOf(Mn.product)<0),ba=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ya=Bn&&window.location.href||"http://localhost",va=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Bn,hasStandardBrowserEnv:xa,hasStandardBrowserWebWorkerEnv:ba,navigator:Mn,origin:ya},Symbol.toStringTag,{value:"Module"})),V={...va,...ga};function wa(e,t){return Kt(e,new V.classes.URLSearchParams,{visitor:function(n,r,s,i){return V.isNode&&x.isBuffer(n)?(this.append(r,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function Ca(e){return x.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function ja(e){const t={},n=Object.keys(e);let r;const s=n.length;let i;for(r=0;r<s;r++)i=n[r],t[i]=e[i];return t}function ks(e){function t(n,r,s,i){let l=n[i++];if(l==="__proto__")return!0;const a=Number.isFinite(+l),c=i>=n.length;return l=!l&&x.isArray(s)?s.length:l,c?(x.hasOwnProp(s,l)?s[l]=[s[l],r]:s[l]=r,!a):((!s[l]||!x.isObject(s[l]))&&(s[l]=[]),t(n,r,s[l],i)&&x.isArray(s[l])&&(s[l]=ja(s[l])),!a)}if(x.isFormData(e)&&x.isFunction(e.entries)){const n={};return x.forEachEntry(e,(r,s)=>{t(Ca(r),s,n,0)}),n}return null}function Sa(e,t,n){if(x.isString(e))try{return(t||JSON.parse)(e),x.trim(e)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(e)}const dt={transitional:Fn,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const r=n.getContentType()||"",s=r.indexOf("application/json")>-1,i=x.isObject(t);if(i&&x.isHTMLForm(t)&&(t=new FormData(t)),x.isFormData(t))return s?JSON.stringify(ks(t)):t;if(x.isArrayBuffer(t)||x.isBuffer(t)||x.isStream(t)||x.isFile(t)||x.isBlob(t)||x.isReadableStream(t))return t;if(x.isArrayBufferView(t))return t.buffer;if(x.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return wa(t,this.formSerializer).toString();if((a=x.isFileList(t))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Kt(a?{"files[]":t}:t,c&&new c,this.formSerializer)}}return i||s?(n.setContentType("application/json",!1),Sa(t)):t}],transformResponse:[function(t){const n=this.transitional||dt.transitional,r=n&&n.forcedJSONParsing,s=this.responseType==="json";if(x.isResponse(t)||x.isReadableStream(t))return t;if(t&&x.isString(t)&&(r&&!this.responseType||s)){const l=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(t,this.parseReviver)}catch(a){if(l)throw a.name==="SyntaxError"?N.from(a,N.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:V.classes.FormData,Blob:V.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};x.forEach(["delete","get","head","post","put","patch"],e=>{dt.headers[e]={}});const Na=x.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ka=e=>{const t={};let n,r,s;return e&&e.split(`
`).forEach(function(l){s=l.indexOf(":"),n=l.substring(0,s).trim().toLowerCase(),r=l.substring(s+1).trim(),!(!n||t[n]&&Na[n])&&(n==="set-cookie"?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t},_r=Symbol("internals");function rt(e){return e&&String(e).trim().toLowerCase()}function Dt(e){return e===!1||e==null?e:x.isArray(e)?e.map(Dt):String(e)}function Ra(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}const Ea=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function xn(e,t,n,r,s){if(x.isFunction(r))return r.call(this,t,n);if(s&&(t=n),!!x.isString(t)){if(x.isString(r))return t.indexOf(r)!==-1;if(x.isRegExp(r))return r.test(t)}}function Aa(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,r)=>n.toUpperCase()+r)}function Ta(e,t){const n=x.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(s,i,l){return this[r].call(this,t,s,i,l)},configurable:!0})})}let Q=class{constructor(t){t&&this.set(t)}set(t,n,r){const s=this;function i(a,c,d){const u=rt(c);if(!u)throw new Error("header name must be a non-empty string");const p=x.findKey(s,u);(!p||s[p]===void 0||d===!0||d===void 0&&s[p]!==!1)&&(s[p||c]=Dt(a))}const l=(a,c)=>x.forEach(a,(d,u)=>i(d,u,c));if(x.isPlainObject(t)||t instanceof this.constructor)l(t,n);else if(x.isString(t)&&(t=t.trim())&&!Ea(t))l(ka(t),n);else if(x.isObject(t)&&x.isIterable(t)){let a={},c,d;for(const u of t){if(!x.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[d=u[0]]=(c=a[d])?x.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}l(a,n)}else t!=null&&i(n,t,r);return this}get(t,n){if(t=rt(t),t){const r=x.findKey(this,t);if(r){const s=this[r];if(!n)return s;if(n===!0)return Ra(s);if(x.isFunction(n))return n.call(this,s,r);if(x.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=rt(t),t){const r=x.findKey(this,t);return!!(r&&this[r]!==void 0&&(!n||xn(this,this[r],r,n)))}return!1}delete(t,n){const r=this;let s=!1;function i(l){if(l=rt(l),l){const a=x.findKey(r,l);a&&(!n||xn(r,r[a],a,n))&&(delete r[a],s=!0)}}return x.isArray(t)?t.forEach(i):i(t),s}clear(t){const n=Object.keys(this);let r=n.length,s=!1;for(;r--;){const i=n[r];(!t||xn(this,this[i],i,t,!0))&&(delete this[i],s=!0)}return s}normalize(t){const n=this,r={};return x.forEach(this,(s,i)=>{const l=x.findKey(r,i);if(l){n[l]=Dt(s),delete n[i];return}const a=t?Aa(i):String(i).trim();a!==i&&delete n[i],n[a]=Dt(s),r[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const n=Object.create(null);return x.forEach(this,(r,s)=>{r!=null&&r!==!1&&(n[s]=t&&x.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,n])=>t+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...n){const r=new this(t);return n.forEach(s=>r.set(s)),r}static accessor(t){const r=(this[_r]=this[_r]={accessors:{}}).accessors,s=this.prototype;function i(l){const a=rt(l);r[a]||(Ta(s,l),r[a]=!0)}return x.isArray(t)?t.forEach(i):i(t),this}};Q.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);x.reduceDescriptors(Q.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(r){this[n]=r}}});x.freezeMethods(Q);function bn(e,t){const n=this||dt,r=t||n,s=Q.from(r.headers);let i=r.data;return x.forEach(e,function(a){i=a.call(n,i,s.normalize(),t?t.status:void 0)}),s.normalize(),i}function Rs(e){return!!(e&&e.__CANCEL__)}let ut=class extends N{constructor(t,n,r){super(t??"canceled",N.ERR_CANCELED,n,r),this.name="CanceledError",this.__CANCEL__=!0}};function Es(e,t,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?e(n):t(new N("Request failed with status code "+n.status,[N.ERR_BAD_REQUEST,N.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function za(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}function Oa(e,t){e=e||10;const n=new Array(e),r=new Array(e);let s=0,i=0,l;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),u=r[i];l||(l=d),n[s]=c,r[s]=d;let p=i,g=0;for(;p!==s;)g+=n[p++],p=p%e;if(s=(s+1)%e,s===i&&(i=(i+1)%e),d-l<t)return;const h=u&&d-u;return h?Math.round(g*1e3/h):void 0}}function _a(e,t){let n=0,r=1e3/t,s,i;const l=(d,u=Date.now())=>{n=u,s=null,i&&(clearTimeout(i),i=null),e(...d)};return[(...d)=>{const u=Date.now(),p=u-n;p>=r?l(d,u):(s=d,i||(i=setTimeout(()=>{i=null,l(s)},r-p)))},()=>s&&l(s)]}const Bt=(e,t,n=3)=>{let r=0;const s=Oa(50,250);return _a(i=>{const l=i.loaded,a=i.lengthComputable?i.total:void 0,c=l-r,d=s(c),u=l<=a;r=l;const p={loaded:l,total:a,progress:a?l/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&u?(a-l)/d:void 0,event:i,lengthComputable:a!=null,[t?"download":"upload"]:!0};e(p)},n)},Mr=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Lr=e=>(...t)=>x.asap(()=>e(...t)),Ma=V.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,V.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(V.origin),V.navigator&&/(msie|trident)/i.test(V.navigator.userAgent)):()=>!0,La=V.hasStandardBrowserEnv?{write(e,t,n,r,s,i,l){if(typeof document>"u")return;const a=[`${e}=${encodeURIComponent(t)}`];x.isNumber(n)&&a.push(`expires=${new Date(n).toUTCString()}`),x.isString(r)&&a.push(`path=${r}`),x.isString(s)&&a.push(`domain=${s}`),i===!0&&a.push("secure"),x.isString(l)&&a.push(`SameSite=${l}`),document.cookie=a.join("; ")},read(e){if(typeof document>"u")return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function Ha(e){return typeof e!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function Pa(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function As(e,t,n){let r=!Ha(t);return e&&(r||n==!1)?Pa(e,t):t}const Hr=e=>e instanceof Q?{...e}:e;function Oe(e,t){t=t||{};const n={};function r(d,u,p,g){return x.isPlainObject(d)&&x.isPlainObject(u)?x.merge.call({caseless:g},d,u):x.isPlainObject(u)?x.merge({},u):x.isArray(u)?u.slice():u}function s(d,u,p,g){if(x.isUndefined(u)){if(!x.isUndefined(d))return r(void 0,d,p,g)}else return r(d,u,p,g)}function i(d,u){if(!x.isUndefined(u))return r(void 0,u)}function l(d,u){if(x.isUndefined(u)){if(!x.isUndefined(d))return r(void 0,d)}else return r(void 0,u)}function a(d,u,p){if(p in t)return r(d,u);if(p in e)return r(void 0,d)}const c={url:i,method:i,data:i,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:a,headers:(d,u,p)=>s(Hr(d),Hr(u),p,!0)};return x.forEach(Object.keys({...e,...t}),function(u){if(u==="__proto__"||u==="constructor"||u==="prototype")return;const p=x.hasOwnProp(c,u)?c[u]:s,g=p(e[u],t[u],u);x.isUndefined(g)&&p!==a||(n[u]=g)}),n}const Ts=e=>{const t=Oe({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:s,xsrfCookieName:i,headers:l,auth:a}=t;if(t.headers=l=Q.from(l),t.url=Ns(As(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),a&&l.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),x.isFormData(n)){if(V.hasStandardBrowserEnv||V.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(x.isFunction(n.getHeaders)){const c=n.getHeaders(),d=["content-type","content-length"];Object.entries(c).forEach(([u,p])=>{d.includes(u.toLowerCase())&&l.set(u,p)})}}if(V.hasStandardBrowserEnv&&(r&&x.isFunction(r)&&(r=r(t)),r||r!==!1&&Ma(t.url))){const c=s&&i&&La.read(i);c&&l.set(s,c)}return t},Ia=typeof XMLHttpRequest<"u",Da=Ia&&function(e){return new Promise(function(n,r){const s=Ts(e);let i=s.data;const l=Q.from(s.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:d}=s,u,p,g,h,m;function y(){h&&h(),m&&m(),s.cancelToken&&s.cancelToken.unsubscribe(u),s.signal&&s.signal.removeEventListener("abort",u)}let b=new XMLHttpRequest;b.open(s.method.toUpperCase(),s.url,!0),b.timeout=s.timeout;function C(){if(!b)return;const R=Q.from("getAllResponseHeaders"in b&&b.getAllResponseHeaders()),E={data:!a||a==="text"||a==="json"?b.responseText:b.response,status:b.status,statusText:b.statusText,headers:R,config:e,request:b};Es(function(B){n(B),y()},function(B){r(B),y()},E),b=null}"onloadend"in b?b.onloadend=C:b.onreadystatechange=function(){!b||b.readyState!==4||b.status===0&&!(b.responseURL&&b.responseURL.indexOf("file:")===0)||setTimeout(C)},b.onabort=function(){b&&(r(new N("Request aborted",N.ECONNABORTED,e,b)),b=null)},b.onerror=function(z){const E=z&&z.message?z.message:"Network Error",U=new N(E,N.ERR_NETWORK,e,b);U.event=z||null,r(U),b=null},b.ontimeout=function(){let z=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const E=s.transitional||Fn;s.timeoutErrorMessage&&(z=s.timeoutErrorMessage),r(new N(z,E.clarifyTimeoutError?N.ETIMEDOUT:N.ECONNABORTED,e,b)),b=null},i===void 0&&l.setContentType(null),"setRequestHeader"in b&&x.forEach(l.toJSON(),function(z,E){b.setRequestHeader(E,z)}),x.isUndefined(s.withCredentials)||(b.withCredentials=!!s.withCredentials),a&&a!=="json"&&(b.responseType=s.responseType),d&&([g,m]=Bt(d,!0),b.addEventListener("progress",g)),c&&b.upload&&([p,h]=Bt(c),b.upload.addEventListener("progress",p),b.upload.addEventListener("loadend",h)),(s.cancelToken||s.signal)&&(u=R=>{b&&(r(!R||R.type?new ut(null,e,b):R),b.abort(),b=null)},s.cancelToken&&s.cancelToken.subscribe(u),s.signal&&(s.signal.aborted?u():s.signal.addEventListener("abort",u)));const T=za(s.url);if(T&&V.protocols.indexOf(T)===-1){r(new N("Unsupported protocol "+T+":",N.ERR_BAD_REQUEST,e));return}b.send(i||null)})},Fa=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r=new AbortController,s;const i=function(d){if(!s){s=!0,a();const u=d instanceof Error?d:this.reason;r.abort(u instanceof N?u:new ut(u instanceof Error?u.message:u))}};let l=t&&setTimeout(()=>{l=null,i(new N(`timeout of ${t}ms exceeded`,N.ETIMEDOUT))},t);const a=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),e=null)};e.forEach(d=>d.addEventListener("abort",i));const{signal:c}=r;return c.unsubscribe=()=>x.asap(a),c}},Ba=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let r=0,s;for(;r<n;)s=r+t,yield e.slice(r,s),r=s},$a=async function*(e,t){for await(const n of Wa(e))yield*Ba(n,t)},Wa=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const t=e.getReader();try{for(;;){const{done:n,value:r}=await t.read();if(n)break;yield r}}finally{await t.cancel()}},Pr=(e,t,n,r)=>{const s=$a(e,t);let i=0,l,a=c=>{l||(l=!0,r&&r(c))};return new ReadableStream({async pull(c){try{const{done:d,value:u}=await s.next();if(d){a(),c.close();return}let p=u.byteLength;if(n){let g=i+=p;n(g)}c.enqueue(new Uint8Array(u))}catch(d){throw a(d),d}},cancel(c){return a(c),s.return()}},{highWaterMark:2})},Ir=64*1024,{isFunction:Lt}=x,Ua=(({Request:e,Response:t})=>({Request:e,Response:t}))(x.global),{ReadableStream:Dr,TextEncoder:Fr}=x.global,Br=(e,...t)=>{try{return!!e(...t)}catch{return!1}},qa=e=>{e=x.merge.call({skipUndefined:!0},Ua,e);const{fetch:t,Request:n,Response:r}=e,s=t?Lt(t):typeof fetch=="function",i=Lt(n),l=Lt(r);if(!s)return!1;const a=s&&Lt(Dr),c=s&&(typeof Fr=="function"?(m=>y=>m.encode(y))(new Fr):async m=>new Uint8Array(await new n(m).arrayBuffer())),d=i&&a&&Br(()=>{let m=!1;const y=new n(V.origin,{body:new Dr,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!y}),u=l&&a&&Br(()=>x.isReadableStream(new r("").body)),p={stream:u&&(m=>m.body)};s&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!p[m]&&(p[m]=(y,b)=>{let C=y&&y[m];if(C)return C.call(y);throw new N(`Response type '${m}' is not supported`,N.ERR_NOT_SUPPORT,b)})});const g=async m=>{if(m==null)return 0;if(x.isBlob(m))return m.size;if(x.isSpecCompliantForm(m))return(await new n(V.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(x.isArrayBufferView(m)||x.isArrayBuffer(m))return m.byteLength;if(x.isURLSearchParams(m)&&(m=m+""),x.isString(m))return(await c(m)).byteLength},h=async(m,y)=>{const b=x.toFiniteNumber(m.getContentLength());return b??g(y)};return async m=>{let{url:y,method:b,data:C,signal:T,cancelToken:R,timeout:z,onDownloadProgress:E,onUploadProgress:U,responseType:B,headers:le,withCredentials:fe="same-origin",fetchOptions:Ke}=Ts(m),Ve=t||fetch;B=B?(B+"").toLowerCase():"text";let Ce=Fa([T,R&&R.toAbortSignal()],z),O=null;const ae=Ce&&Ce.unsubscribe&&(()=>{Ce.unsubscribe()});let ft;try{if(U&&d&&b!=="get"&&b!=="head"&&(ft=await h(le,C))!==0){let J=new n(y,{method:"POST",body:C,duplex:"half"}),he;if(x.isFormData(C)&&(he=J.headers.get("content-type"))&&le.setContentType(he),J.body){const[Le,je]=Mr(ft,Bt(Lr(U)));C=Pr(J.body,Ir,Le,je)}}x.isString(fe)||(fe=fe?"include":"omit");const W=i&&"credentials"in n.prototype,q={...Ke,signal:Ce,method:b.toUpperCase(),headers:le.normalize().toJSON(),body:C,duplex:"half",credentials:W?fe:void 0};O=i&&new n(y,q);let re=await(i?Ve(O,Ke):Ve(y,q));const I=u&&(B==="stream"||B==="response");if(u&&(E||I&&ae)){const J={};["status","statusText","headers"].forEach(Se=>{J[Se]=re[Se]});const he=x.toFiniteNumber(re.headers.get("content-length")),[Le,je]=E&&Mr(he,Bt(Lr(E),!0))||[];re=new r(Pr(re.body,Ir,Le,()=>{je&&je(),ae&&ae()}),J)}B=B||"text";let Me=await p[x.findKey(p,B)||"text"](re,m);return!I&&ae&&ae(),await new Promise((J,he)=>{Es(J,he,{data:Me,headers:Q.from(re.headers),status:re.status,statusText:re.statusText,config:m,request:O})})}catch(W){throw ae&&ae(),W&&W.name==="TypeError"&&/Load failed|fetch/i.test(W.message)?Object.assign(new N("Network Error",N.ERR_NETWORK,m,O,W&&W.response),{cause:W.cause||W}):N.from(W,W&&W.code,m,O,W&&W.response)}}},Ka=new Map,zs=e=>{let t=e&&e.env||{};const{fetch:n,Request:r,Response:s}=t,i=[r,s,n];let l=i.length,a=l,c,d,u=Ka;for(;a--;)c=i[a],d=u.get(c),d===void 0&&u.set(c,d=a?new Map:qa(t)),u=d;return d};zs();const $n={http:ca,xhr:Da,fetch:{get:zs}};x.forEach($n,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});const $r=e=>`- ${e}`,Va=e=>x.isFunction(e)||e===null||e===!1;function Ga(e,t){e=x.isArray(e)?e:[e];const{length:n}=e;let r,s;const i={};for(let l=0;l<n;l++){r=e[l];let a;if(s=r,!Va(r)&&(s=$n[(a=String(r)).toLowerCase()],s===void 0))throw new N(`Unknown adapter '${a}'`);if(s&&(x.isFunction(s)||(s=s.get(t))))break;i[a||"#"+l]=s}if(!s){const l=Object.entries(i).map(([c,d])=>`adapter ${c} `+(d===!1?"is not supported by the environment":"is not available in the build"));let a=n?l.length>1?`since :
`+l.map($r).join(`
`):" "+$r(l[0]):"as no adapter specified";throw new N("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s}const Os={getAdapter:Ga,adapters:$n};function yn(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new ut(null,e)}function Wr(e){return yn(e),e.headers=Q.from(e.headers),e.data=bn.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Os.getAdapter(e.adapter||dt.adapter,e)(e).then(function(r){return yn(e),r.data=bn.call(e,e.transformResponse,r),r.headers=Q.from(r.headers),r},function(r){return Rs(r)||(yn(e),r&&r.response&&(r.response.data=bn.call(e,e.transformResponse,r.response),r.response.headers=Q.from(r.response.headers))),Promise.reject(r)})}const _s="1.13.5",Vt={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Vt[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const Ur={};Vt.transitional=function(t,n,r){function s(i,l){return"[Axios v"+_s+"] Transitional option '"+i+"'"+l+(r?". "+r:"")}return(i,l,a)=>{if(t===!1)throw new N(s(l," has been removed"+(n?" in "+n:"")),N.ERR_DEPRECATED);return n&&!Ur[l]&&(Ur[l]=!0,console.warn(s(l," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(i,l,a):!0}};Vt.spelling=function(t){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${t}`),!0)};function Ja(e,t,n){if(typeof e!="object")throw new N("options must be an object",N.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let s=r.length;for(;s-- >0;){const i=r[s],l=t[i];if(l){const a=e[i],c=a===void 0||l(a,i,e);if(c!==!0)throw new N("option "+i+" must be "+c,N.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new N("Unknown option "+i,N.ERR_BAD_OPTION)}}const Ft={assertOptions:Ja,validators:Vt},ne=Ft.validators;let Ae=class{constructor(t){this.defaults=t||{},this.interceptors={request:new Or,response:new Or}}async request(t,n){try{return await this._request(t,n)}catch(r){if(r instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(t,n){typeof t=="string"?(n=n||{},n.url=t):n=t||{},n=Oe(this.defaults,n);const{transitional:r,paramsSerializer:s,headers:i}=n;r!==void 0&&Ft.assertOptions(r,{silentJSONParsing:ne.transitional(ne.boolean),forcedJSONParsing:ne.transitional(ne.boolean),clarifyTimeoutError:ne.transitional(ne.boolean),legacyInterceptorReqResOrdering:ne.transitional(ne.boolean)},!1),s!=null&&(x.isFunction(s)?n.paramsSerializer={serialize:s}:Ft.assertOptions(s,{encode:ne.function,serialize:ne.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Ft.assertOptions(n,{baseUrl:ne.spelling("baseURL"),withXsrfToken:ne.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let l=i&&x.merge(i.common,i[n.method]);i&&x.forEach(["delete","get","head","post","put","patch","common"],m=>{delete i[m]}),n.headers=Q.concat(l,i);const a=[];let c=!0;this.interceptors.request.forEach(function(y){if(typeof y.runWhen=="function"&&y.runWhen(n)===!1)return;c=c&&y.synchronous;const b=n.transitional||Fn;b&&b.legacyInterceptorReqResOrdering?a.unshift(y.fulfilled,y.rejected):a.push(y.fulfilled,y.rejected)});const d=[];this.interceptors.response.forEach(function(y){d.push(y.fulfilled,y.rejected)});let u,p=0,g;if(!c){const m=[Wr.bind(this),void 0];for(m.unshift(...a),m.push(...d),g=m.length,u=Promise.resolve(n);p<g;)u=u.then(m[p++],m[p++]);return u}g=a.length;let h=n;for(;p<g;){const m=a[p++],y=a[p++];try{h=m(h)}catch(b){y.call(this,b);break}}try{u=Wr.call(this,h)}catch(m){return Promise.reject(m)}for(p=0,g=d.length;p<g;)u=u.then(d[p++],d[p++]);return u}getUri(t){t=Oe(this.defaults,t);const n=As(t.baseURL,t.url,t.allowAbsoluteUrls);return Ns(n,t.params,t.paramsSerializer)}};x.forEach(["delete","get","head","options"],function(t){Ae.prototype[t]=function(n,r){return this.request(Oe(r||{},{method:t,url:n,data:(r||{}).data}))}});x.forEach(["post","put","patch"],function(t){function n(r){return function(i,l,a){return this.request(Oe(a||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:l}))}}Ae.prototype[t]=n(),Ae.prototype[t+"Form"]=n(!0)});let Xa=class Ms{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const l=new Promise(a=>{r.subscribe(a),i=a}).then(s);return l.cancel=function(){r.unsubscribe(i)},l},t(function(i,l,a){r.reason||(r.reason=new ut(i,l,a),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new Ms(function(s){t=s}),cancel:t}}};function Ya(e){return function(n){return e.apply(null,n)}}function Qa(e){return x.isObject(e)&&e.isAxiosError===!0}const Ln={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Ln).forEach(([e,t])=>{Ln[t]=e});function Ls(e){const t=new Ae(e),n=hs(Ae.prototype.request,t);return x.extend(n,Ae.prototype,t,{allOwnKeys:!0}),x.extend(n,t,null,{allOwnKeys:!0}),n.create=function(s){return Ls(Oe(e,s))},n}const F=Ls(dt);F.Axios=Ae;F.CanceledError=ut;F.CancelToken=Xa;F.isCancel=Rs;F.VERSION=_s;F.toFormData=Kt;F.AxiosError=N;F.Cancel=F.CanceledError;F.all=function(t){return Promise.all(t)};F.spread=Ya;F.isAxiosError=Qa;F.mergeConfig=Oe;F.AxiosHeaders=Q;F.formToJSON=e=>ks(x.isHTMLForm(e)?new FormData(e):e);F.getAdapter=Os.getAdapter;F.HttpStatusCode=Ln;F.default=F;const{Axios:Cc,AxiosError:jc,CanceledError:Sc,isCancel:Nc,CancelToken:kc,VERSION:Rc,all:Ec,Cancel:Ac,isAxiosError:Tc,spread:zc,toFormData:Oc,AxiosHeaders:_c,HttpStatusCode:Mc,formToJSON:Lc,getAdapter:Hc,mergeConfig:Pc}=F,Za=`${window.location.protocol}//${window.location.host}/api/v1`,ec=async e=>(await F.post(`${Za}/chat/ask`,{question:e.question,novel_id:e.novel_id,chapter_id:e.chapter_id,novel_filter:e.novel_filter,alpha:e.alpha??.32,similarity_threshold:e.similarity_threshold??.5})).data;function tc({msg:e,onNavigateToScene:t,chapterId:n}){const[r,s]=v.useState(!1),[i,l]=v.useState(!1);let a=e.content,c="";if(e.role==="assistant"&&e.content.includes("[ ]")){const d=e.content.split("[ ]");a=d[0].replace("[ ]","").trim(),c=d[1].trim()}return o.jsx("div",{className:`chatbot-message ${e.role}`,style:{marginBottom:"1rem",alignSelf:e.role==="user"?"flex-end":"flex-start"},children:o.jsxs("div",{className:`chatbot-message-bubble ${e.role==="user"?"user-bubble":"assistant-bubble"}`,style:{padding:"0.75rem 1rem",borderRadius:"1.5rem",maxWidth:"100%",backgroundColor:e.role==="user"?"var(--primary)":"var(--chat-assistant-bg)",color:e.role==="user"?"var(--primary-foreground)":"var(--chat-assistant-text)",border:e.role==="assistant"?"1px solid var(--border)":"none",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[o.jsx("p",{style:{whiteSpace:"pre-wrap",margin:0},children:a}),c&&o.jsxs("div",{className:"detail-container",style:{marginTop:"0.5rem",borderTop:"1px solid var(--border)",paddingTop:"0.5rem"},children:[o.jsxs("button",{onClick:()=>l(!i),style:{background:"none",border:"none",padding:0,cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.75rem",color:"var(--muted-foreground)",fontWeight:"600"},children:[i?o.jsx(ce,{size:14,strokeWidth:2.5}):o.jsx(se,{size:14,strokeWidth:2.5})," "]}),i&&o.jsx("p",{style:{whiteSpace:"pre-wrap",marginTop:"0.5rem",fontSize:"0.9rem",color:"var(--muted-foreground)",lineHeight:"1.5"},children:c})]}),e.source&&o.jsxs("div",{className:"source-container",style:{marginTop:"0.5rem",borderTop:"1px solid var(--border)",paddingTop:"0.5rem"},children:[o.jsxs("button",{onClick:()=>s(!r),style:{background:"none",border:"none",padding:0,cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontSize:"0.75rem",color:e.role==="user"?"var(--primary-foreground)":"var(--muted-foreground)",opacity:.9,fontWeight:"600"},children:[r?o.jsx(ce,{size:14,strokeWidth:2.5}):o.jsx(se,{size:14,strokeWidth:2.5}),""]}),r&&o.jsxs("div",{style:{fontSize:"0.75rem",color:e.role==="user"?"var(--primary-foreground)":"var(--muted-foreground)",opacity:.85,marginTop:"0.5rem",fontStyle:"italic",display:"flex",flexDirection:"column",gap:"4px",animation:"fadeIn 0.2s ease-in-out"},children:[o.jsxs("div",{children:[o.jsx("strong",{children:":"})," ",e.source.filename,e.source.scene_index!==void 0&&` (Scene ${e.source.scene_index+1})`,` (: ${(e.similarity*100).toFixed(1)}%)`]}),e.source.summary&&o.jsx("div",{style:{backgroundColor:"rgba(0,0,0,0.1)",padding:"6px",borderRadius:"4px",marginTop:"2px",borderLeft:"2px solid currentColor",fontSize:"0.8rem",lineHeight:"1.4"},children:e.source.summary}),e.source.scene_index!==void 0&&t&&o.jsxs("button",{onClick:()=>{t(e.source.scene_index)},disabled:!!(e.source.chapter_id&&n&&e.source.chapter_id!==n),style:{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:"4px",color:"currentColor",padding:"4px 8px",cursor:e.source.chapter_id&&n&&e.source.chapter_id!==n?"not-allowed":"pointer",opacity:e.source.chapter_id&&n&&e.source.chapter_id!==n?.5:1,alignSelf:"flex-start",fontSize:"0.75rem",marginTop:"6px",transition:"all 0.2s"},title:e.source.chapter_id&&n&&e.source.chapter_id!==n?"  .":"",children:[" ",e.source.chapter_id?`Ch.${e.source.chapter_id} `:"","Scene ",e.source.scene_index+1," "]})]})]})]})})}function nc({onNavigateToScene:e,novelId:t,chapterId:n}){const[r,s]=v.useState(""),[i,l]=v.useState([{role:"assistant",content:"!    ."}]),[a,c]=v.useState(!1),d=v.useRef(null);v.useEffect(()=>{d.current?.scrollIntoView({behavior:"smooth"})},[i]);const u=async()=>{if(r.trim()&&!a){const g=r.trim();s(""),l(h=>[...h,{role:"user",content:g}]),c(!0);try{const h=await ec({question:g,novel_id:t,chapter_id:n,alpha:.32,similarity_threshold:.35});l(m=>[...m,{role:"assistant",content:h.answer,source:h.source,similarity:h.similarity}])}catch(h){console.error("Chat error:",h);const m=h.response?.data?.detail||h.message||"    .";l(y=>[...y,{role:"assistant",content:`: ${m}`}])}finally{c(!1)}}},p=g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),u())};return o.jsxs("div",{className:"chatbot-container",style:{display:"flex",flexDirection:"column",height:"100%",backgroundColor:"var(--modal-bg)"},children:[o.jsxs("div",{className:"chatbot-messages",style:{flex:1,overflowY:"auto",padding:"1rem"},children:[i.map((g,h)=>o.jsx(tc,{msg:g,onNavigateToScene:e,chapterId:n},h)),a&&o.jsx("div",{className:"chatbot-message assistant",style:{alignSelf:"flex-start"},children:o.jsx("div",{className:"chatbot-message-bubble assistant-bubble",style:{padding:"0.75rem 1rem",borderRadius:"1.5rem",backgroundColor:"var(--chat-assistant-bg)",border:"1px solid var(--border)",color:"var(--chat-assistant-text)"},children:o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx(Cn,{size:16,strokeWidth:2.5,className:"animate-spin",style:{color:"var(--muted-foreground)"}}),o.jsx("span",{style:{color:"var(--muted-foreground)"},children:"  ..."})]})})}),o.jsx("div",{ref:d})]}),o.jsxs("div",{className:"chatbot-input-area",style:{padding:"1rem",display:"flex",gap:"0.5rem",backgroundColor:"var(--modal-bg)",borderTop:"1px solid var(--border)"},children:[o.jsx("input",{type:"text",className:"chatbot-input",placeholder:" ...",value:r,onChange:g=>s(g.target.value),onKeyPress:p,disabled:a,style:{flex:1,padding:"0.75rem",borderRadius:"0.5rem",fontSize:"0.95rem",outline:"none",transition:"border-color 0.2s",backgroundColor:"var(--input-bg)",color:"var(--input-text)",border:"1px solid var(--input-border)"}}),o.jsx("button",{className:"chatbot-send",onClick:u,disabled:a||!r.trim(),style:{backgroundColor:"var(--primary)",color:"var(--primary-foreground)",border:"none",borderRadius:"0.5rem",padding:"0.75rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.2s",minWidth:"45px",opacity:a||!r.trim()?.5:1},children:a?o.jsx(Cn,{size:20,strokeWidth:2.5,className:"animate-spin"}):o.jsx(Gr,{size:20,strokeWidth:2.5})})]})]})}function rc({onNavigateToScene:e,onCheckConsistency:t,onPredictStory:n,onOpenCharacterChat:r,onOpenSettings:s,novelId:i,chapterId:l,mode:a="writer"}){const[c,d]=v.useState(!1),[u,p]=v.useState(!1),{theme:g}=Jr(),h=()=>{d(!c)},m=()=>{p(!0),d(!1)},y=()=>{p(!1)},b=()=>{t&&t(),d(!1)};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"floating-menu-container",children:[c&&o.jsxs("div",{className:"floating-menu-options",children:[o.jsx("button",{className:"menu-option btn-purple",onClick:()=>{n&&n(),d(!1)},title:"  (What-If)",children:o.jsx(jn,{size:20,strokeWidth:2.5})}),a!=="reader"&&o.jsx(o.Fragment,{children:o.jsx("button",{className:"menu-option btn-blue",onClick:b,title:"",children:o.jsx(Ho,{size:20,strokeWidth:2.5})})}),o.jsx("button",{className:"menu-option btn-brown-med",onClick:m,title:"",children:o.jsx(Po,{size:20,strokeWidth:2.5})}),o.jsx("button",{className:"menu-option btn-brown-rich",onClick:()=>{r&&r(),d(!1)},title:" ",children:o.jsx(Sn,{size:20,strokeWidth:2.5})}),o.jsx("button",{className:"menu-option btn-brown-dark",onClick:()=>{s&&s(),d(!1)},title:"",children:o.jsx(Vr,{size:20,strokeWidth:2.5})})]}),o.jsx("button",{className:"floating-menu-btn",onClick:h,style:{backgroundColor:g==="sepia"?"var(--color-dark-brown)":"var(--primary)",color:"var(--primary-foreground)"},children:o.jsx(Io,{size:24,strokeWidth:2.5})})]}),u&&o.jsxs("div",{className:"chatbot-modal",style:{position:"fixed",bottom:"15px",right:"25px",width:"650px",height:"850px",borderRadius:"1rem",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",display:"flex",flexDirection:"column",zIndex:1e3,overflow:"hidden"},children:[o.jsx("div",{className:"chatbot-header",style:{padding:"16px",borderBottom:"1px solid var(--border)",display:"flex",justifyContent:"flex-end",alignItems:"center",backgroundColor:"var(--modal-header-bg)",color:"var(--modal-header-text)"},children:o.jsx("button",{className:"chatbot-close",onClick:y,style:{color:"currentColor",background:"none",border:"none",cursor:"pointer"},children:o.jsx(it,{size:20,strokeWidth:2.5})})}),o.jsx("div",{className:"chatbot-content",style:{flex:1,overflow:"hidden"},children:o.jsx(nc,{onNavigateToScene:e,novelId:i,chapterId:l})})]})]})}function sc({onClose:e}){const[t,n]=v.useState(""),[r,s]=v.useState(""),[i,l]=v.useState(localStorage.getItem("llm_model")||"gemini-2.0-flash"),[a,c]=v.useState(!1);v.useEffect(()=>{d()},[]),v.useEffect(()=>{i&&localStorage.setItem("llm_model",i)},[i]);const d=async()=>{try{const h=await Xr("/auth/me");n(h.username),s(h.email)}catch(h){console.error("Failed to fetch profile:",h)}},u=()=>{localStorage.removeItem("token"),localStorage.removeItem("userMode"),window.location.href="/"},p=()=>{M.info("    .")},g=[{value:"gemini-2.0-flash",label:"Gemini 2.0 Flash ()"},{value:"gemini-2.5-flash",label:"Gemini 2.5 Flash ()"},{value:"gemini-1.5-pro",label:"Gemini 1.5 Pro ()"},{value:"gemini-2.0",label:"Gemini 2.0 ()"}];return o.jsx("div",{className:"settings-panel",children:o.jsxs("div",{className:"settings-container",children:[o.jsxs("div",{className:"settings-header",children:[o.jsx("h2",{className:"settings-title",children:""}),o.jsx("button",{onClick:e,className:"close-button","aria-label":"Close settings",children:o.jsx(it,{size:24,strokeWidth:2})})]}),o.jsxs("div",{className:"settings-content",children:[o.jsx("div",{className:"profile-section",children:o.jsxs("div",{className:"profile-header-text",children:[o.jsx("h3",{className:"section-title",children:" "}),o.jsx("p",{className:"section-description",children:"   AI   ."})]})}),o.jsxs("div",{className:"settings-form",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:""}),o.jsx("input",{className:"form-input",value:t,onChange:h=>n(h.target.value),placeholder:" "})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:""}),o.jsx("input",{className:"form-input disabled",value:r,disabled:!0}),o.jsx("p",{className:"input-note",children:"    "})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{className:"form-label",children:"LLM AI  "}),o.jsxs("div",{className:"select-wrapper",children:[o.jsxs("button",{className:`select-button ${a?"active":""}`,onClick:()=>c(!a),children:[o.jsx("span",{children:g.find(h=>h.value===i)?.label||i}),o.jsx(se,{size:16,className:`dropdown-icon ${a?"open":""}`})]}),a&&o.jsx("div",{className:"select-dropdown",children:g.map(h=>o.jsx("button",{className:`select-option ${i===h.value?"selected":""}`,onClick:()=>{l(h.value),c(!1)},children:h.label},h.value))})]}),o.jsx("p",{className:"model-note",children:" AI      "})]}),o.jsxs("div",{className:"danger-zone",children:[o.jsx("h3",{className:"danger-title",children:" "}),o.jsx("p",{className:"danger-description",children:"     ."}),o.jsx("button",{className:"btn btn-destructive",onClick:p,children:" "})]})]})]}),o.jsx("div",{className:"settings-footer",children:o.jsxs("button",{className:"btn btn-outline",onClick:u,children:[o.jsx(Do,{size:18}),""]})})]})})}function oc({isOpen:e,onClose:t,result:n,isLoading:r,onNavigateToQuote:s,onReanalyze:i}){return e?o.jsxs("div",{style:{position:"fixed",bottom:"16px",right:"20px",width:"450px",height:"750px",backgroundColor:"var(--modal-bg)",color:"var(--modal-text)",boxShadow:"0 8px 32px rgba(0,0,0,0.15)",zIndex:1e3,display:"flex",flexDirection:"column",borderRadius:"16px",border:"1px solid var(--modal-border)",animation:"slideUp 0.3s ease"},children:[o.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--modal-border)",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"var(--modal-header-bg)",color:"var(--modal-header-text)",borderRadius:"16px 16px 0 0"},children:[o.jsx("h2",{style:{margin:0,fontSize:"1.15rem",fontWeight:"600",color:"inherit"},children:"   "}),o.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[i&&n&&!r&&o.jsx("button",{onClick:i,title:"",style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"inherit",display:"flex",alignItems:"center"},children:o.jsx(Fo,{size:18,strokeWidth:2.5})}),o.jsx("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"inherit"},children:o.jsx(it,{size:22,strokeWidth:2.5})})]})]}),o.jsx("div",{style:{flex:1,overflowY:"auto",padding:"20px",backgroundColor:"var(--modal-bg)",borderRadius:"0 0 16px 16px"},children:r?o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:"16px"},children:[o.jsx(Cn,{size:48,strokeWidth:2.5,style:{animation:"spin 1s linear infinite",color:"var(--primary)"}}),o.jsx("p",{style:{color:"var(--muted-foreground)",fontSize:"0.95rem"},children:" ..."})]}):n?o.jsxs("div",{children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"16px",borderRadius:"8px",backgroundColor:n.status==="  "?"rgba(220, 38, 38, 0.1)":"rgba(22, 163, 74, 0.1)",marginBottom:"20px",border:"1px solid",borderColor:n.status==="  "?"rgba(220, 38, 38, 0.2)":"rgba(22, 163, 74, 0.2)"},children:[n.status==="  "?o.jsx(Bo,{size:24,color:"#DC2626",strokeWidth:2.5}):o.jsx(ar,{size:24,color:"#16A34A",strokeWidth:2.5}),o.jsxs("div",{children:[o.jsx("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:"600",color:n.status==="  "?"#DC2626":"#16A34A"},children:n.status}),n.message&&o.jsx("p",{style:{margin:"4px 0 0 0",fontSize:"0.9rem",color:"var(--muted-foreground)"},children:n.message})]})]}),n.results&&n.results.length>0?o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:n.results.map((l,a)=>o.jsxs("div",{style:{padding:"16px",border:"1px solid var(--modal-border)",borderRadius:"8px",backgroundColor:"var(--card)",color:"var(--card-foreground)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"12px"},children:[o.jsx("span",{style:{fontSize:"0.85rem",fontWeight:"600",padding:"4px 10px",borderRadius:"12px",backgroundColor:l.type===" "?"rgba(220, 38, 38, 0.1)":"rgba(217, 119, 6, 0.1)",color:l.type===" "?"#DC2626":"#D97706"},children:l.type}),s&&l.quote&&o.jsxs("button",{onClick:()=>s(l.quote),style:{display:"flex",alignItems:"center",gap:"4px",padding:"4px 8px",fontSize:"0.8rem",backgroundColor:"var(--primary)",color:"var(--primary-foreground)",border:"none",borderRadius:"4px",cursor:"pointer"},children:[o.jsx($o,{size:14,strokeWidth:2.5}),""]})]}),o.jsxs("div",{style:{marginBottom:"12px"},children:[o.jsx("p",{style:{margin:"0 0 4px 0",fontSize:"0.85rem",fontWeight:"600",color:"var(--modal-text)"},children:" :"}),o.jsxs("p",{style:{margin:0,fontSize:"0.9rem",color:"var(--modal-text)",fontStyle:"italic",backgroundColor:"var(--secondary)",padding:"8px",borderRadius:"4px",border:"1px solid var(--border)"},children:['"',l.quote,'"']})]}),o.jsxs("div",{style:{marginBottom:"12px"},children:[o.jsx("p",{style:{margin:"0 0 4px 0",fontSize:"0.85rem",fontWeight:"600",color:"var(--modal-text)"},children:":"}),o.jsx("p",{style:{margin:0,fontSize:"0.9rem",color:"var(--muted-foreground)",lineHeight:"1.5"},children:l.description})]}),o.jsxs("div",{children:[o.jsx("p",{style:{margin:"0 0 4px 0",fontSize:"0.85rem",fontWeight:"600",color:"var(--modal-text)"},children:":"}),o.jsx("p",{style:{margin:0,fontSize:"0.9rem",color:"#059669",lineHeight:"1.5"},children:l.suggestion})]})]},a))}):o.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"var(--muted-foreground)"},children:[o.jsx(ar,{size:48,color:"#16A34A",strokeWidth:2.5,style:{margin:"0 auto 16px"}}),o.jsx("p",{style:{fontSize:"1rem",fontWeight:"500"},children:"  !"}),o.jsx("p",{style:{fontSize:"0.9rem",marginTop:"8px"},children:"   ."})]})]}):o.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"var(--muted-foreground)"},children:[o.jsx("p",{children:"  ."}),o.jsx("p",{style:{fontSize:"0.9rem",marginTop:"8px"},children:"    ."})]})}),o.jsx("style",{children:`
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                @keyframes slideUp {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `})]}):null}function ic({isOpen:e,onClose:t,messages:n,onSendMessage:r,isLoading:s,onClearChat:i}){const[l,a]=v.useState(""),c=v.useRef(null),d=()=>{c.current?.scrollIntoView({behavior:"smooth"})},u=h=>{const m=h.match(/[^.!?]+[.!?]+(\s|$)/g);if(!m)return h;let y="";for(let b=0;b<m.length;b++)y+=m[b],(b+1)%2===0&&b<m.length-1&&(y+=`

`);return y||h};v.useEffect(()=>{e&&d()},[n,e,s]);const p=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),g())},g=()=>{!l.trim()||s||(r(l),a(""))};return e?o.jsxs("div",{style:{position:"fixed",bottom:"16px",right:"20px",width:"500px",height:"850px",backgroundColor:"var(--modal-bg)",boxShadow:"0 8px 32px rgba(0,0,0,0.15)",zIndex:900,display:"flex",flexDirection:"column",borderRadius:"16px",border:"1px solid var(--modal-border)",animation:"slideUp 0.3s ease"},children:[o.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--modal-border)",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"var(--modal-header-bg)",color:"var(--modal-header-text)",borderRadius:"16px 16px 0 0"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx(jn,{size:20,strokeWidth:2.5,className:s?"animate-spin":"",style:{color:"var(--primary)"}}),o.jsx("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:"bold",color:"inherit"},children:"  "})]}),o.jsxs("div",{style:{display:"flex",gap:"8px"},children:[i&&n.length>0&&o.jsx("button",{onClick:i,title:" ",style:{background:"none",border:"none",cursor:"pointer",color:"var(--muted-foreground)",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(Wo,{size:18,strokeWidth:2.5})}),o.jsx("button",{onClick:t,style:{background:"none",border:"none",cursor:"pointer",color:"var(--muted-foreground)",padding:"4px",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(it,{size:20,strokeWidth:2.5})})]})]}),o.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"20px",backgroundColor:"var(--modal-bg)",display:"flex",flexDirection:"column",gap:"20px"},children:[n.length===0&&o.jsxs("div",{style:{textAlign:"center",color:"var(--muted-foreground)",marginTop:"60px",display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"},children:[o.jsx(jn,{size:48,strokeWidth:2.5,style:{opacity:.2,color:"var(--primary)"}}),o.jsxs("p",{style:{lineHeight:"1.5"},children:['"   ?"',o.jsx("br",{}),"AI   ."]})]}),n.map(h=>o.jsxs("div",{style:{display:"flex",justifyContent:h.role==="user"?"flex-end":"flex-start",gap:"12px"},children:[h.role==="assistant"&&o.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:"var(--secondary)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:"4px"},children:o.jsx(Uo,{size:18,strokeWidth:2.5,style:{color:"var(--primary)"}})}),o.jsx("div",{style:{maxWidth:"85%",padding:"12px 16px",borderRadius:"12px",borderTopLeftRadius:h.role==="assistant"?"2px":"12px",borderTopRightRadius:h.role==="user"?"2px":"12px",backgroundColor:h.role==="user"?"var(--primary)":"var(--input-bg)",color:h.role==="user"?"var(--primary-foreground)":"var(--input-text)",boxShadow:h.role==="assistant"?"0 1px 2px rgba(0,0,0,0.05)":"none",border:h.role==="assistant"?"1px solid var(--input-border)":"none",lineHeight:"1.6",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:h.role==="assistant"?u(h.content):h.content}),h.role==="user"&&o.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:"var(--secondary)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,marginTop:"4px"},children:o.jsx(qo,{size:18,strokeWidth:2.5,style:{color:"var(--muted-foreground)"}})})]},h.id)),s&&o.jsxs("div",{style:{display:"flex",gap:"12px"},children:[o.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",backgroundColor:"var(--secondary)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:o.jsx(cr,{className:"animate-spin",size:18,strokeWidth:2.5,style:{color:"var(--primary)"}})}),o.jsx("div",{style:{padding:"12px 16px",borderRadius:"12px",borderTopLeftRadius:"2px",backgroundColor:"var(--input-bg)",border:"1px solid var(--input-border)",color:"var(--muted-foreground)",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:"  ..."})]}),o.jsx("div",{ref:c})]}),o.jsx("div",{style:{padding:"16px",backgroundColor:"var(--modal-bg)",borderTop:"1px solid var(--modal-border)",borderRadius:"0 0 16px 16px"},children:o.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"flex-end",backgroundColor:"var(--input-bg)",padding:"8px",borderRadius:"12px",border:"1px solid var(--input-border)"},children:[o.jsx("textarea",{value:l,onChange:h=>a(h.target.value),onKeyDown:p,placeholder:" ...",style:{flex:1,border:"none",background:"transparent",resize:"none",height:"auto",minHeight:"24px",maxHeight:"120px",padding:"8px",fontSize:"0.95rem",outline:"none",fontFamily:"inherit",overflowY:"auto",color:"var(--input-text)"},rows:1,onInput:h=>{h.currentTarget.style.height="auto",h.currentTarget.style.height=h.currentTarget.scrollHeight+"px"}}),o.jsx("button",{onClick:g,disabled:!l.trim()||s,style:{backgroundColor:l.trim()&&!s?"var(--primary)":"var(--muted)",color:l.trim()&&!s?"var(--primary-foreground)":"var(--muted-foreground)",border:"none",borderRadius:"8px",padding:"8px",display:"flex",alignItems:"center",justifyContent:"center",cursor:l.trim()&&!s?"pointer":"not-allowed",transition:"background-color 0.2s",width:"36px",height:"36px"},children:s?o.jsx(cr,{size:18,strokeWidth:2.5,className:"animate-spin"}):o.jsx(Gr,{size:18,strokeWidth:2.5})})]})}),o.jsx("style",{children:`
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                @keyframes slideUp {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .animate-spin {
                    animation: spin 1s linear infinite;
                }
            `})]}):null}const pt=`${pt}/prediction`,lc=async(e,t)=>{const n=await fetch(`${pt}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({novel_id:e,text:t})});if(!n.ok)throw new Error("Failed to start prediction task");return n.json()},ac=async e=>{const t=await fetch(`${pt}/task/${e}`);if(!t.ok)throw new Error("Failed to get task status");return t.json()},cc=async e=>{const t=await fetch(`${pt}/history/${e}`);if(!t.ok)throw new Error("Failed to get prediction history");return t.json()},dc=async e=>{const t=await fetch(`${pt}/history/${e}`,{method:"DELETE"});if(!t.ok)throw new Error("Failed to clear prediction history");return t.json()};async function uc(e,t){return(await F.get(`${Nn}/analysis/consistency/${e}/${t}`)).data}const pc=()=>{const e=localStorage.getItem("token"),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t},fc=async e=>Xr("/images/generate",{method:"POST",headers:pc(),body:JSON.stringify(e)});function Ic({fileName:e,onBack:t,novelId:n,chapterId:r,mode:s="writer",onOpenCharacterChat:i,onCloseCharacterChat:l,onNavigateChapter:a,showCharacterChat:c}){const[d,u]=v.useState(!0),[p,g]=v.useState(!0),[h,m]=v.useState(!1),[y,b]=v.useState(!1),[C,T]=v.useState(!1),[R,z]=v.useState(!1),[E,U]=v.useState(""),[B,le]=v.useState(!1),[fe,Ke]=v.useState(!1),[Ve,Ce]=v.useState(!1),[O,ae]=v.useState(null),[ft,W]=v.useState(!1),[q,re]=v.useState([]),[I,Me]=v.useState(void 0),[J,he]=v.useState(""),[Le,je]=v.useState(""),[Se,ht]=v.useState(!1),[Wn,Un]=v.useState(!1),Gt=v.useRef(null),Ge=v.useRef(),[mt,gt]=v.useState(!1),[Hs,qn]=v.useState(!1),Jt=v.useRef(null),[Ne,Xt]=v.useState(!1),[te,Kn]=v.useState(!1),[Yt,Je]=v.useState(!1),[Vn,xt]=v.useState([]),[Ps,bt]=v.useState(!1),[Gn,Jn]=v.useState(null),[He,yt]=v.useState(null),[Pe,Qt]=v.useState(!1),[Is,Ds]=v.useState(0),[Fs,Bs]=v.useState(0),[Ie,$s]=v.useState([]),Zt=v.useRef(!1),en=v.useRef(()=>Promise.resolve()),{theme:vt,setTheme:Ws}=Jr(),[X,Xn]=v.useState(()=>{const f=localStorage.getItem("reader-settings");return f?JSON.parse(f):{fontSize:18,lineHeight:2,paragraphSpacing:40,contentWidth:80,fontFamily:"Noto Serif KR",theme:"light"}});v.useEffect(()=>{s==="reader"&&X.theme!==vt&&Xn(f=>({...f,theme:vt}))},[vt,s]);const Us=f=>{Xn(f),f.theme&&f.theme!==vt&&Ws(f.theme)};v.useEffect(()=>{localStorage.setItem("reader-settings",JSON.stringify(X)),s==="reader"?(document.documentElement.setAttribute("data-reader-theme",X.theme),document.documentElement.setAttribute("data-theme",X.theme)):document.documentElement.removeAttribute("data-reader-theme")},[X,s]),v.useEffect(()=>{if(Gn){const f=setTimeout(()=>{Jn(null)},15e3);return()=>clearTimeout(f)}},[Gn]),v.useEffect(()=>{n&&r?(Yn(),Qn()):Ve||(U(`          .
               .
"     ?"  .

  (      )                .            .

    .    ", ! !"         . (     ,      .)            ,   .    ,           .       ,          .`),Ce(!0))},[n,r]),v.useEffect(()=>{let f,w=!1;if(I==="PROCESSING"||I==="PENDING"){let j=3e3;const S=async()=>{if(!(w||!n||!r)){try{const _=await Qo(n,r),k=(_.status||"").toUpperCase();if(k==="COMPLETED"||k==="FAILED"){Me(k),Xt(!1),k==="COMPLETED"?(M.success(" !  ."),Yn(),Qn()):M.error(` : ${_.message||"   "}`);return}}catch{M.error("   .")}w||(j=Math.min(j*1.5,2e4),f=setTimeout(S,j))}};S()}return()=>{w=!0,f&&clearTimeout(f)}},[I,n,r]);const Yn=async()=>{if(!(!n||!r)){le(!0);try{const f=await Go(n,r);U(f.content),Me(f.storyboard_status)}catch{M.error("   .")}finally{le(!1),Ce(!0)}}},Qn=async()=>{if(!(!n||!r)){W(!0);try{const f=await Jo(n,r);ae(f),f.scenes&&f.scenes.length>0&&re(f.scenes.map(w=>w.original_text.trim()))}catch{}finally{W(!1)}}},tn=async()=>{if(!(!n||!r)){Ke(!0);try{const f=q.length>0?q.map(w=>w.trim()).join(`

`):E;await Zo(n,r,{content:f}),Qt(!1),M.success(".")}catch{M.error(" .")}finally{Ke(!1)}}},[P,Xe]=v.useState(null),[$,Ye]=v.useState(null),[De,wt]=v.useState(null),[ke,Ct]=v.useState(null),[nn,Qe]=v.useState(!1),[qs,be]=v.useState(!1),[Ks,Re]=v.useState(null),[K,Ze]=v.useState(null),[Vs,Gs]=v.useState({}),[jt,Zn]=v.useState(!1),[St,er]=v.useState(!1),[Nt,tr]=v.useState(!1),et=v.useRef(),tt=v.useRef();v.useEffect(()=>{c&&(Qe(!1),Je(!1))},[c]),v.useEffect(()=>{Zt.current=Pe},[Pe]),v.useEffect(()=>{en.current=tn}),v.useEffect(()=>{n&&Xo(n).then(f=>{$s(f.sort((w,j)=>w.chapter_number-j.chapter_number))}).catch(()=>{})},[n]),v.useEffect(()=>{if(s==="reader"||!n||!r)return;const f=setInterval(()=>{Zt.current&&en.current()},3e4);return()=>clearInterval(f)},[n,r,s]),v.useEffect(()=>{const f=w=>{Zt.current&&(w.preventDefault(),w.returnValue="")};return window.addEventListener("beforeunload",f),()=>window.removeEventListener("beforeunload",f)},[]),v.useEffect(()=>{const f=w=>{(w.ctrlKey||w.metaKey)&&w.key==="s"&&(w.preventDefault(),s!=="reader"&&n&&r&&en.current()),w.key==="Escape"&&(nn?Qe(!1):Yt?Je(!1):R&&z(!1))};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[s,n,r,nn,Yt,R]);const nt=v.useRef();v.useEffect(()=>(nt.current&&clearTimeout(nt.current),nt.current=setTimeout(()=>{const w=(q.length>0?q.join(`

`):E).replace(/<br\s*\/?>/gi,`
`).replace(/<[^>]+>/g,"");Ds(w.replace(/\s/g,"").length);const j=w.trim().split(/\s+/).filter(Boolean);Bs(j.length)},500),()=>{nt.current&&clearTimeout(nt.current)}),[E,q]);const kt=Ie.findIndex(f=>f.id===r),nr=kt>0?Ie[kt-1]:null,rr=kt<Ie.length-1?Ie[kt+1]:null,sr=async f=>{Pe&&n&&r&&await tn(),a?.(f.id,f.title)},me=(f,w)=>{Xe(null),Ye(null),wt(null),Ct(null),Ze(null),Zn(!1),er(!1),tr(!1),z(!1),w&&w.trim()&&Jn({sceneIndex:f,text:w.trim(),timestamp:Date.now()}),et.current&&clearTimeout(et.current),tt.current&&clearTimeout(tt.current),et.current=setTimeout(()=>{const j=document.getElementById(`scene-block-${f}`);j&&(j.scrollIntoView({behavior:"smooth",block:"start"}),j.style.transition="background-color 0.5s",j.style.backgroundColor="rgba(79, 70, 229, 0.1)",tt.current=setTimeout(()=>{j.style.backgroundColor="transparent"},1e3))},100)},or=async()=>{be(!0),Re(null);try{const f=q.length>0?q.join(`

`):E,w=await fetch(`${Nn}/analysis/consistency`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({novel_id:n,chapter_id:r,text:f})});if(!w.ok)throw new Error("  ");const{task_id:j}=await w.json();let S=2e3,_=0;const k=async()=>{if(_++,_>60){be(!1),Re({status:"",message:"    .   ."});return}try{const Z=await(await fetch(`${Nn}/analysis/task/${j}`)).json();if(Z.status==="COMPLETED"){Re(Z.result),be(!1),M.success(" .");return}else if(Z.status==="FAILED"){be(!1),Re({status:"",message:Z.error||"  ."}),M.error("   .");return}}catch(L){console.error("Polling error:",L),be(!1),Re({status:"",message:"      ."});return}S=Math.min(S*1.5,15e3),setTimeout(k,S)};setTimeout(k,S)}catch(f){console.error("Analysis error:",f),Re({status:" ",message:"    ."}),be(!1)}},Js=async()=>{if(Qe(!0),Je(!1),l?.(),n&&r)try{be(!0);const f=await uc(n,r);if(f.cached&&f.result){Re(f.result),be(!1);return}}catch{}await or()},Xs=async()=>{if(Je(!0),Qe(!1),l?.(),n&&Vn.length===0)try{const{history:f}=await cc(n);if(f.length>0){const w=[];for(const j of f)w.push({id:`h-u-${j.id}`,role:"user",content:j.user_input}),w.push({id:`h-a-${j.id}`,role:"assistant",content:j.prediction});xt(w)}}catch{}},Ys=async f=>{if(!n||!f.trim())return;const w={id:Date.now().toString(),role:"user",content:f};xt(j=>[...j,w]),bt(!0);try{const{task_id:j}=await lc(n,f);let S=2e3;const _=async()=>{try{const k=await ac(j);if(k.status==="COMPLETED"){const L=k.result.prediction||k.result.text||(typeof k.result=="string"?k.result:JSON.stringify(k.result)),Z={id:(Date.now()+1).toString(),role:"assistant",content:L};xt(un=>[...un,Z]),bt(!1),Notification.permission==="granted"&&document.hidden&&new Notification("StoryProof  ",{body:" .",icon:"/favicon.ico"});return}else if(k.status==="FAILED"){bt(!1),M.error("    .");return}}catch{}S=Math.min(S*1.5,15e3),setTimeout(_,S)};setTimeout(_,S)}catch{bt(!1),M.error("  .")}},Qs=()=>{Xs()},Zs=f=>{if(!f)return;const w=S=>S.replace(/[^a-zA-Z0-9-]/g,""),j=w(f);if(q.length>0){let S=-1;if(S=q.findIndex(_=>w(_).includes(j)),S===-1&&j.length>40){const _=j.substring(0,30),k=j.substring(j.length-30);S=q.findIndex(L=>{const Z=w(L);return Z.includes(_)&&Z.includes(k)})}S!==-1?me(S,f):M.error("     . (       )")}else{const S=document.querySelector(".novel-text-editor");if(S&&E)if(w(E).indexOf(j)!==-1){const L=E.indexOf(f);if(L!==-1){S.focus(),S.setSelectionRange(L,L+f.length);const Z=E.substring(0,L).split(`
`).length;S.scrollTop=(Z-1)*24}else M.warning(" ,      .")}else M.error("     .")}},eo=()=>{M.info("   .")},to=()=>{He&&He.chain().focus().toggleHighlight().run()},no=()=>{M.info("   .")},ir=()=>{z(!0)},rn=v.useMemo(()=>O?.characters&&O.characters.length>0?O.characters:[{name:"",first_appearance:0,appearance_count:5,appearances:[0,1,2,3,4],traits:[" "," "]},{name:" ",first_appearance:0,appearance_count:3,appearances:[0,1,3],traits:[""," "]},{name:"",first_appearance:0,appearance_count:1,appearances:[0]}],[O]),sn=v.useMemo(()=>O?.items&&O.items.length>0?O.items:[{name:"",first_appearance:0},{name:"",first_appearance:0},{name:" ",first_appearance:0}],[O]),on=v.useMemo(()=>O?.key_events&&O.key_events.length>0?O.key_events:[{summary:"     ",scene_index:0,importance:""},{summary:"    ",scene_index:1,importance:""},{summary:"    ",scene_index:2,importance:""}],[O]),ro=()=>{if(!(!n||!r)){if(I==="PROCESSING"){M.warning("   .  .");return}M(" ?",{description:"  (,  )   .",action:{label:"",onClick:async()=>{Xt(!0),Me("PROCESSING");try{await ei(n,r),M.success("  .   .")}catch{M.error("  "),Me("FAILED"),Xt(!1)}}},cancel:{label:"",onClick:()=>{}}})}},ln=v.useMemo(()=>O?.locations&&O.locations.length>0?O.locations:[{name:"",description:"   ",scenes:[0]},{name:" ",description:"   ",scenes:[2]}],[O]),A=Le.trim().toLowerCase(),Fe=v.useMemo(()=>A?rn.filter(f=>f.name.toLowerCase().includes(A)||(f.description||"").toLowerCase().includes(A)||(f.traits||[]).some(w=>w.toLowerCase().includes(A))):rn,[rn,A]),Be=v.useMemo(()=>A?sn.filter(f=>f.name.toLowerCase().includes(A)||(f.description||"").toLowerCase().includes(A)):sn,[sn,A]),$e=v.useMemo(()=>A?ln.filter(f=>f.name.toLowerCase().includes(A)||(f.description||"").toLowerCase().includes(A)):ln,[ln,A]),We=v.useMemo(()=>A?on.filter(f=>(f.summary||"").toLowerCase().includes(A)):on,[on,A]),Rt=v.useMemo(()=>!A||!O?.scenes?[]:O.scenes.filter(f=>(f.original_text||"").toLowerCase().includes(A)||(f.summary||"").toLowerCase().includes(A)),[O,A]);v.useEffect(()=>(Ge.current&&clearTimeout(Ge.current),Ge.current=setTimeout(()=>{je(J)},300),()=>{Ge.current&&clearTimeout(Ge.current)}),[J]),v.useEffect(()=>()=>{et.current&&clearTimeout(et.current),tt.current&&clearTimeout(tt.current)},[]),v.useEffect(()=>{A&&(Fe.length>0&&g(!0),Be.length>0&&m(!0),$e.length>0&&b(!0),We.length>0&&T(!0))},[A,Fe.length,Be.length,$e.length,We.length]),v.useEffect(()=>{const f=j=>{Gt.current&&!Gt.current.contains(j.target)&&ht(!1)},w=j=>{j.key==="Escape"&&Se&&ht(!1)};return document.addEventListener("mousedown",f),document.addEventListener("keydown",w),()=>{document.removeEventListener("mousedown",f),document.removeEventListener("keydown",w)}},[Se]),v.useEffect(()=>{const f=j=>{Jt.current&&!Jt.current.contains(j.target)&&gt(!1)},w=j=>{j.key==="Escape"&&mt&&gt(!1)};return document.addEventListener("mousedown",f),document.addEventListener("keydown",w),()=>{document.removeEventListener("mousedown",f),document.removeEventListener("keydown",w)}},[mt]);const so=(f,w,j=80)=>{if(!w)return o.jsx("span",{children:f.length>j?f.slice(0,j)+"...":f});const _=f.toLowerCase().indexOf(w.toLowerCase());if(_===-1)return o.jsx("span",{children:f.length>j?f.slice(0,j)+"...":f});const k=Math.max(0,_-20),L=Math.min(f.length,_+w.length+40),Z=k>0?"...":"",un=L<f.length?"...":"",oo=f.slice(k,_),io=f.slice(_,_+w.length),lo=f.slice(_+w.length,L);return o.jsxs("span",{children:[Z,oo,o.jsx("mark",{className:"bible-search-highlight",children:io}),lo,un]})},an=async f=>{if(!(!n||!r)){Un(!0),ht(!1);try{await ni(n,r,f,Le||void 0),M.success(`${f.toUpperCase()}  .`)}catch{M.error(" .")}finally{Un(!1)}}},cn=async f=>{if(!(!n||!r)){qn(!0),gt(!1);try{await ti(n,r,f),M.success(`${f.toUpperCase()}  .`)}catch{M.error(" .")}finally{qn(!1)}}};if(B&&!Ve)return o.jsx("div",{className:`chapter-detail-container loading ${d?"sidebar-open":""}`,children:o.jsx("div",{className:"loading-spinner"})});const dn=async(f,w)=>{if(!n||!r){M.error("/  .");return}Kn(!0);try{const S=(await fc({novel_id:n,chapter_id:r,entity_type:f,entity_name:w.name,description:w.description||w.name})).image_url,_=k=>k.map(L=>L.name===w.name?{...L,image:S}:L);ae(k=>{if(!k)return null;const L={...k};return f==="character"&&(L.characters=_(L.characters)),f==="item"&&(L.items=_(L.items)),f==="location"&&(L.locations=_(L.locations)),L}),f==="character"&&P?.name===w.name&&Xe(k=>k?{...k,image:S}:null),f==="item"&&$?.name===w.name&&Ye(k=>k?{...k,image:S}:null),f==="location"&&K?.name===w.name&&Ze(k=>k?{...k,image:S}:null),M.success(" !")}catch(j){console.error("Image generation failed:",j),M.error("  .")}finally{Kn(!1)}};return o.jsxs("div",{className:`chapter-detail-container ${d?"sidebar-open":""}`,children:[o.jsx("style",{children:`
                @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                .spin-animation { animation: spin 1s linear infinite; }
            `}),o.jsxs("div",{className:"chapter-detail-header",style:{display:"flex",alignItems:"center",padding:"16px 24px",borderBottom:"1px solid var(--border)",backgroundColor:"var(--card)",position:"sticky",top:0,zIndex:10},children:[o.jsx("button",{className:"back-button",onClick:t,style:{marginRight:"16px",padding:"8px",borderRadius:"50%",border:"none",backgroundColor:"transparent",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx(Ko,{size:24,color:"var(--muted-foreground)"})}),o.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:"4px"},children:[Ie.length>1&&nr&&o.jsx("button",{onClick:()=>sr(nr),title:" ",style:{padding:"4px",borderRadius:"50%",border:"none",backgroundColor:"transparent",cursor:"pointer",display:"flex",alignItems:"center",color:"var(--muted-foreground)"},children:o.jsx(dr,{size:20})}),o.jsx("h1",{className:"chapter-detail-title",style:{fontSize:"1.25rem",fontWeight:600,color:"var(--foreground)",margin:0},children:e}),Ie.length>1&&rr&&o.jsx("button",{onClick:()=>sr(rr),title:" ",style:{padding:"4px",borderRadius:"50%",border:"none",backgroundColor:"transparent",cursor:"pointer",display:"flex",alignItems:"center",color:"var(--muted-foreground)"},children:o.jsx(fn,{size:20})})]}),n&&r&&s!=="reader"&&o.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[o.jsxs("span",{style:{fontSize:"0.8rem",color:"var(--muted-foreground)",whiteSpace:"nowrap"},children:[Is.toLocaleString(),"  ",Fs.toLocaleString(),""]}),o.jsx("span",{style:{fontSize:"0.75rem",color:Pe?"#D97706":"var(--muted-foreground)",whiteSpace:"nowrap",padding:"2px 8px",borderRadius:"4px",backgroundColor:Pe?"rgba(217, 119, 6, 0.1)":"transparent"},children:fe?" ...":Pe?" ":""}),o.jsxs("button",{className:"reanalyze-button",onClick:ro,disabled:I==="PROCESSING"||I==="PENDING"||Ne,title:I==="PROCESSING"||I==="PENDING"?"  ...":"AI ",style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:I==="PROCESSING"||I==="PENDING"||Ne?"var(--muted)":"transparent",color:I==="PROCESSING"||I==="PENDING"||Ne?"var(--muted-foreground)":"var(--primary)",border:I==="PROCESSING"||I==="PENDING"||Ne?"1px solid var(--border)":"1px solid var(--primary)",borderRadius:"6px",cursor:I==="PROCESSING"||I==="PENDING"||Ne?"not-allowed":"pointer",fontSize:"0.9rem",fontWeight:500},children:[o.jsx(At,{size:16,className:I==="PROCESSING"||I==="PENDING"||Ne?"spin-animation":""}),I==="PROCESSING"||I==="PENDING"||Ne?" ...":""]}),o.jsxs("button",{className:"save-button",onClick:tn,disabled:fe,style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 16px",backgroundColor:"var(--primary)",color:"var(--primary-foreground)",border:"none",borderRadius:"6px",cursor:fe?"wait":"pointer",fontSize:"0.9rem",fontWeight:500},children:[o.jsx(Vo,{size:18}),fe?" ...":""]}),o.jsxs("div",{className:"chapter-export-wrapper",ref:Jt,children:[o.jsx("button",{className:"chapter-export-btn",onClick:()=>gt(!mt),disabled:Hs,title:" ",children:o.jsx(ur,{size:16})}),mt&&o.jsxs("div",{className:"chapter-export-dropdown",children:[o.jsxs("button",{onClick:()=>cn("txt"),className:"export-dropdown-item",children:[o.jsx(hn,{size:14})," TXT ()"]}),o.jsxs("button",{onClick:()=>cn("pdf"),className:"export-dropdown-item",children:[o.jsx(mn,{size:14})," PDF"]}),o.jsxs("button",{onClick:()=>cn("docx"),className:"export-dropdown-item",children:[o.jsx(mn,{size:14})," DOCX ()"]})]})]})]})]}),s==="reader"?o.jsx(jl,{editor:He,readerSettings:X,onSettingsChange:Us,onBookmark:eo,onHighlight:to,onAddMemo:no}):o.jsx(Cl,{editor:He,onOpenSettings:()=>{ir()}}),o.jsxs("div",{className:"chapter-detail-layout",children:[o.jsxs("div",{className:`dictionary-sidebar ${d?"open":"closed"}`,children:[o.jsxs("div",{className:"bible-toolbar",children:[o.jsxs("div",{className:"bible-search-wrapper",children:[o.jsx(pr,{size:14,className:"bible-search-icon"}),o.jsx("input",{type:"text",className:"bible-search-input",placeholder:" ...",value:J,onChange:f=>he(f.target.value)}),J&&o.jsx("button",{className:"bible-search-clear",onClick:()=>{he(""),je("")},children:o.jsx(it,{size:12})})]}),o.jsxs("div",{className:"export-dropdown-wrapper",ref:Gt,children:[o.jsx("button",{className:"bible-export-btn",onClick:()=>ht(!Se),disabled:Wn,title:J?" ":" ",children:Wn?o.jsx(At,{size:14,className:"spin-animation"}):o.jsx(ur,{size:14})}),Se&&o.jsxs("div",{className:"export-dropdown",children:[o.jsxs("button",{onClick:()=>an("txt"),className:"export-dropdown-item",children:[o.jsx(hn,{size:14}),o.jsx("span",{children:"TXT ()"})]}),o.jsxs("button",{onClick:()=>an("pdf"),className:"export-dropdown-item",children:[o.jsx(mn,{size:14}),o.jsx("span",{children:"PDF"})]}),o.jsxs("button",{onClick:()=>an("docx"),className:"export-dropdown-item",children:[o.jsx(hn,{size:14}),o.jsx("span",{children:"DOCX ()"})]})]})]})]}),A&&Rt.length>0&&o.jsxs("div",{className:"sidebar-section",children:[o.jsx("div",{className:"section-header active",style:{cursor:"default"},children:o.jsxs("div",{className:"section-header-content",children:[o.jsx(pr,{size:18}),o.jsxs("h3",{className:"section-title",children:["  (",Rt.length,")"]})]})}),o.jsx("div",{className:"section-content",children:Rt.map((f,w)=>o.jsxs("div",{className:"section-item bible-scene-result interactable",onClick:()=>me(f.scene_index),style:{cursor:"pointer"},children:[o.jsxs("div",{className:"item-name",style:{fontSize:"0.85rem"},children:["Scene ",f.scene_index+1]}),o.jsx("div",{className:"item-description",style:{fontSize:"0.8rem"},children:so(f.original_text,A,100)})]},w))})]}),A&&Rt.length===0&&Fe.length===0&&Be.length===0&&$e.length===0&&We.length===0&&o.jsx("div",{style:{padding:"16px",textAlign:"center",color:"var(--muted-foreground)",fontSize:"0.875rem"},children:"  ."}),o.jsxs("div",{className:"sidebar-section",children:[o.jsxs("button",{className:`section-header ${p?"active":""}`,onClick:()=>g(!p),children:[o.jsxs("div",{className:"section-header-content",children:[o.jsx(Sn,{size:18}),o.jsxs("h3",{className:"section-title",children:[" ",A&&`(${Fe.length})`]})]}),p?o.jsx(ce,{size:18}):o.jsx(se,{size:18})]}),p&&o.jsx("div",{className:"section-content",children:ft?o.jsx("div",{style:{padding:"10px",fontSize:"12px",color:"#999"},children:" ..."}):Fe.length===0&&A?o.jsx("div",{style:{padding:"10px",fontSize:"12px",color:"#999"},children:"  "}):Fe.map((f,w)=>o.jsxs("div",{className:"section-item interactable",onClick:()=>Xe(f),style:{cursor:"pointer"},children:[o.jsx("div",{className:"item-name",children:f.name}),o.jsx("div",{className:"item-description",children:f.traits&&f.traits.length>0?o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginTop:"4px"},children:f.traits.slice(0,3).map((j,S)=>o.jsx("span",{className:"trait-tag",children:j},S))}):typeof f.description=="string"&&f.description?f.description.slice(0,30)+"...":`: ${f.appearance_count}`})]},w))})]}),o.jsxs("div",{className:"sidebar-section",children:[o.jsxs("button",{className:`section-header ${h?"active":""}`,onClick:()=>m(!h),children:[o.jsxs("div",{className:"section-header-content",children:[o.jsx(Tt,{size:18}),o.jsxs("h3",{className:"section-title",children:[" ",A&&`(${Be.length})`]})]}),h?o.jsx(ce,{size:18}):o.jsx(se,{size:18})]}),h&&o.jsx("div",{className:"section-content",children:Be.length===0&&A?o.jsx("div",{style:{padding:"10px",fontSize:"12px",color:"#999"},children:"  "}):Be.map((f,w)=>o.jsxs("div",{className:"section-item interactable",onClick:()=>Ye(f),style:{cursor:"pointer"},children:[o.jsx("div",{className:"item-name",children:f.name}),o.jsx("div",{className:"item-description",children:typeof f.description=="string"&&f.description?f.description:` : ${f.first_appearance+1}`})]},w))})]}),o.jsxs("div",{className:"sidebar-section",children:[o.jsxs("button",{className:`section-header ${y?"active":""}`,onClick:()=>b(!y),children:[o.jsxs("div",{className:"section-header-content",children:[o.jsx(fr,{size:18}),o.jsxs("h3",{className:"section-title",children:[" ",A&&`(${$e.length})`]})]}),y?o.jsx(ce,{size:18}):o.jsx(se,{size:18})]}),y&&o.jsx("div",{className:"section-content",children:$e.length===0&&A?o.jsx("div",{style:{padding:"10px",fontSize:"12px",color:"#999"},children:"  "}):$e.map((f,w)=>o.jsxs("div",{className:"section-item interactable",onClick:()=>Ze(f),style:{cursor:"pointer"},children:[o.jsx("div",{className:"item-name",children:f.name}),o.jsx("div",{className:"item-description",children:typeof f.description=="string"&&f.description?f.description:`: ${f.scenes?.length||0}`})]},w))})]}),o.jsxs("div",{className:"sidebar-section",children:[o.jsxs("button",{className:`section-header ${C?"active":""}`,onClick:()=>T(!C),children:[o.jsxs("div",{className:"section-header-content",children:[o.jsx(At,{size:18}),o.jsxs("h3",{className:"section-title",children:["  ",A&&`(${We.length})`]})]}),C?o.jsx(ce,{size:18}):o.jsx(se,{size:18})]}),C&&o.jsx("div",{className:"section-content",children:We.length===0&&A?o.jsx("div",{style:{padding:"10px",fontSize:"12px",color:"#999"},children:"  "}):We.map((f,w)=>o.jsxs("div",{className:"section-item interactable",onClick:()=>wt(f),style:{cursor:"pointer"},children:[o.jsx("div",{className:"item-name",style:{fontSize:"0.95rem"},children:f.summary&&f.summary.length>20?f.summary.substring(0,20)+"...":f.summary}),o.jsxs("div",{className:"item-description",children:[f.scene_index!==void 0?`${f.scene_index+1}`:"",f.importance&&`  : ${f.importance}`]})]},w))})]}),O&&Object.keys(O).filter(f=>!["characters","items","timeline","locations","key_events","scenes"].includes(f)).map(f=>{const w=O[f];if(!Array.isArray(w))return null;const j=Vs[f]??!1;return o.jsxs("div",{className:"sidebar-section",children:[o.jsxs("button",{className:`section-header ${j?"active":""}`,onClick:()=>Gs(S=>({...S,[f]:!S[f]})),children:[o.jsxs("div",{className:"section-header-content",children:[o.jsx(Tt,{size:18})," ",o.jsx("h3",{className:"section-title",children:f.toUpperCase()})]}),j?o.jsx(ce,{size:18}):o.jsx(se,{size:18})]}),j&&o.jsx("div",{className:"section-content",children:w.map((S,_)=>o.jsxs("div",{className:"section-item interactable",onClick:()=>Ct({title:f,item:S}),style:{cursor:"pointer"},children:[o.jsx("div",{className:"item-name",children:S.name||S.title||`Item ${_+1}`}),o.jsx("div",{className:"item-description",children:S.description||S.summary||(typeof S=="string"?S:JSON.stringify(S).slice(0,50))})]},_))})]},f)})]}),o.jsx("button",{className:"dictionary-toggle",onClick:()=>u(!d),children:d?o.jsx(dr,{size:20}):o.jsx(fn,{size:20})}),o.jsx("div",{className:"text-area",style:{overflow:"hidden",display:"flex",flexDirection:"column"},children:o.jsx("div",{className:"text-content",style:{flex:1,padding:0,height:"100%"},children:B?o.jsx("div",{style:{padding:"20px",textAlign:"center"},children:" ..."}):q.length>0?o.jsx("div",{className:"scenes-container",style:{height:"100%",overflowY:"auto",padding:"20px",backgroundColor:s==="reader"?"var(--reader-bg)":"var(--background)"},children:q.map((f,w)=>o.jsxs("div",{id:`scene-block-${w}`,className:"scene-block",style:{position:"relative",marginBottom:"60px"},children:[o.jsxs("div",{style:{position:"absolute",top:"-12px",left:"10px",fontSize:"12px",fontWeight:"bold",color:"var(--primary)",backgroundColor:"var(--card)",padding:"2px 10px",borderRadius:"12px",border:"1px solid var(--border)",zIndex:5,boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:["Scene ",w+1]}),o.jsx("div",{className:"scene-content-wrapper",style:{maxWidth:s==="reader"?`${X.contentWidth}%`:"100%",margin:s==="reader"?"0 auto":"0"},children:o.jsx(Er,{content:f.replace(/\n/g,"<br>"),onUpdate:j=>{const S=[...q];S[w]=j,re(S),Qt(!0)},onFocus:j=>yt(j),onCreated:j=>{w===0&&!He&&yt(j)},editable:s!=="reader",placeholder:` ${w+1}  ...`,className:"tiptap-editor-scene",style:s==="reader"?{fontSize:`${X.fontSize}px`,lineHeight:X.lineHeight,fontFamily:X.fontFamily,color:"var(--text-primary)"}:void 0})})]},w))}):o.jsx("div",{style:{maxWidth:s==="reader"?`${X.contentWidth}%`:"100%",margin:s==="reader"?"0 auto":"0",height:"100%"},children:o.jsx(Er,{content:E.replace(/\n/g,"<br>"),onUpdate:f=>{U(f),Qt(!0)},onFocus:f=>yt(f),onCreated:f=>{He||yt(f)},editable:s!=="reader",placeholder:"  ...",className:"tiptap-editor-full",style:s==="reader"?{fontSize:`${X.fontSize}px`,lineHeight:X.lineHeight,fontFamily:X.fontFamily,color:"var(--text-primary)"}:void 0})})})})]}),P&&o.jsx("div",{className:"modal-overlay",onClick:()=>Xe(null),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsxs("div",{className:"modal-content",onClick:f=>f.stopPropagation(),style:{backgroundColor:"var(--modal-bg, #fff)",padding:"24px",borderRadius:"12px",width:"400px",maxWidth:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",color:"var(--modal-text, #333)",border:"1px solid var(--modal-border, #e5e7eb)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[o.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",margin:0},children:P.name}),o.jsx("button",{onClick:()=>Xe(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:o.jsx(Sn,{size:20})})]}),o.jsxs("div",{style:{marginBottom:"16px",display:"flex",flexDirection:"column",alignItems:"center"},children:[P.image?o.jsx("img",{src:P.image,alt:P.name,style:{width:"100%",maxHeight:"300px",objectFit:"contain",borderRadius:"8px",marginBottom:"8px"}}):o.jsx("div",{style:{width:"100%",height:"200px",backgroundColor:"var(--muted, #f1f5f9)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--muted-foreground, #94a3b8)",marginBottom:"8px"},children:" "}),o.jsx("button",{onClick:()=>dn("character",P),disabled:te,style:{padding:"8px 16px",backgroundColor:te?"var(--muted, #cbd5e1)":"var(--primary, #4f46e5)",color:"var(--primary-foreground, white)",border:"none",borderRadius:"6px",cursor:te?"not-allowed":"pointer",fontWeight:"500",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"8px"},children:te?" ...":P.image?" ":" "})]}),P.aliases&&P.aliases.length>0&&o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("div",{style:{fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginBottom:"4px"},children:""}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:P.aliases.map((f,w)=>o.jsx("span",{style:{fontSize:"0.8rem",padding:"2px 8px",backgroundColor:"var(--muted, #f1f5f9)",borderRadius:"12px",color:"var(--muted-foreground, #475569)",border:"1px solid var(--border)",opacity:.9},children:f},w))})]}),o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("div",{style:{fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginBottom:"4px"},children:""}),o.jsx("p",{style:{lineHeight:"1.6",fontSize:"1rem",margin:0},children:P.description||"  ."})]}),P.traits&&P.traits.length>0&&o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("div",{style:{fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginBottom:"4px"},children:""}),o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:P.traits.map((f,w)=>o.jsx("span",{style:{fontSize:"0.8rem",padding:"4px 10px",backgroundColor:"var(--muted, rgba(79, 70, 229, 0.1))",color:"var(--primary, #4F46E5)",borderRadius:"6px",fontWeight:"500",border:"1px solid var(--border)"},children:f},w))})]}),o.jsxs("div",{style:{display:"flex",gap:"16px",fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginTop:"24px",borderTop:"1px solid var(--border, #eee)",paddingTop:"16px"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[o.jsx("strong",{style:{color:"var(--modal-text)"},children:" :"}),o.jsxs("button",{onClick:()=>me(P.first_appearance,P.name),style:{background:"none",border:"none",color:"var(--primary, #4F46E5)",fontWeight:"bold",cursor:"pointer",textDecoration:"underline",padding:0,fontSize:"inherit"},children:[P.first_appearance+1,""]})]}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("strong",{style:{color:"var(--modal-text)"},children:" :"})," ",P.appearance_count,"",P.appearances&&P.appearances.length>0&&o.jsxs("button",{onClick:()=>Zn(!jt),style:{background:"var(--modal-bg)",border:"1px solid var(--border, #e2e8f0)",borderRadius:"4px",cursor:"pointer",padding:"2px 6px",fontSize:"0.8rem",color:"var(--muted-foreground, #666)",display:"flex",alignItems:"center",gap:"4px"},children:[jt?o.jsx(ce,{size:12}):o.jsx(se,{size:12}),jt?"":" "]})]}),jt&&P.appearances&&o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"10px",maxHeight:"150px",overflowY:"auto",width:"100%",padding:"4px"},children:P.appearances.map(f=>o.jsxs("button",{onClick:()=>me(f,P.name),style:{background:"var(--muted, #f1f5f9)",border:"1px solid var(--border)",borderRadius:"4px",padding:"4px 8px",fontSize:"0.8rem",color:"var(--muted-foreground, #475569)",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:["SCENE ",f+1]},f))})]})]})]})}),$&&o.jsx("div",{className:"modal-overlay",onClick:()=>Ye(null),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsxs("div",{className:"modal-content",onClick:f=>f.stopPropagation(),style:{backgroundColor:"var(--modal-bg, #fff)",padding:"24px",borderRadius:"12px",width:"400px",maxWidth:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",color:"var(--modal-text, #333)",border:"1px solid var(--modal-border, #e5e7eb)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[o.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",margin:0},children:$.name}),o.jsx("button",{onClick:()=>Ye(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:o.jsx(Tt,{size:20})})]}),o.jsxs("div",{style:{marginBottom:"16px",display:"flex",flexDirection:"column",alignItems:"center"},children:[$.image?o.jsx("img",{src:$.image,alt:$.name,style:{width:"100%",maxHeight:"300px",objectFit:"contain",borderRadius:"8px",marginBottom:"8px"}}):o.jsx("div",{style:{width:"100%",height:"200px",backgroundColor:"var(--muted, #f1f5f9)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--muted-foreground, #94a3b8)",marginBottom:"8px"},children:" "}),o.jsx("button",{onClick:()=>dn("item",$),disabled:te,style:{padding:"8px 16px",backgroundColor:te?"var(--muted, #cbd5e1)":"var(--primary, #4f46e5)",color:"var(--primary-foreground, white)",border:"none",borderRadius:"6px",cursor:te?"not-allowed":"pointer",fontWeight:"500",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"8px"},children:te?" ...":$.image?" ":" "})]}),o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("div",{style:{fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginBottom:"4px"},children:""}),o.jsx("p",{style:{lineHeight:"1.6",fontSize:"1rem",margin:0},children:$.description||"  ."})]}),o.jsx("div",{style:{display:"flex",gap:"16px",fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginTop:"24px",borderTop:"1px solid var(--border, #eee)",paddingTop:"16px"},children:o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("strong",{style:{color:"var(--modal-text)"},children:" :"}),o.jsxs("button",{onClick:()=>me($.first_appearance,$.name),style:{background:"none",border:"none",color:"var(--primary, #4F46E5)",fontWeight:"bold",cursor:"pointer",textDecoration:"underline",padding:0,fontSize:"inherit"},children:[$.first_appearance+1,""]})]}),$.appearance_count>0&&o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginTop:"4px"},children:[o.jsx("strong",{style:{color:"var(--modal-text)"},children:" :"})," ",$.appearance_count,"",$.appearances&&$.appearances.length>0&&o.jsxs("button",{onClick:()=>er(!St),style:{background:"var(--modal-bg)",border:"1px solid var(--border, #e2e8f0)",borderRadius:"4px",cursor:"pointer",padding:"2px 6px",fontSize:"0.8rem",color:"var(--muted-foreground, #666)",display:"flex",alignItems:"center",gap:"4px"},children:[St?o.jsx(ce,{size:12}):o.jsx(se,{size:12}),St?"":" "]})]}),St&&$.appearances&&o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"10px",maxHeight:"150px",overflowY:"auto",width:"100%",padding:"4px"},children:$.appearances.map(f=>o.jsxs("button",{onClick:()=>me(f,$.name),style:{background:"var(--muted, #f1f5f9)",border:"1px solid var(--border)",borderRadius:"4px",padding:"4px 8px",fontSize:"0.8rem",color:"var(--muted-foreground, #475569)",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:["SCENE ",f+1]},f))})]})})]})}),K&&o.jsx("div",{className:"modal-overlay",onClick:()=>Ze(null),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsxs("div",{className:"modal-content",onClick:f=>f.stopPropagation(),style:{backgroundColor:"var(--modal-bg, #fff)",padding:"24px",borderRadius:"12px",width:"400px",maxWidth:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",color:"var(--modal-text, #333)",border:"1px solid var(--modal-border, #e5e7eb)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[o.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",margin:0},children:K.name}),o.jsx("button",{onClick:()=>Ze(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:o.jsx(fr,{size:20})})]}),o.jsxs("div",{style:{marginBottom:"16px",display:"flex",flexDirection:"column",alignItems:"center"},children:[K.image?o.jsx("img",{src:K.image,alt:K.name,style:{width:"100%",maxHeight:"300px",objectFit:"contain",borderRadius:"8px",marginBottom:"8px"}}):o.jsx("div",{style:{width:"100%",height:"200px",backgroundColor:"var(--muted, #f1f5f9)",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--muted-foreground, #94a3b8)",marginBottom:"8px"},children:" "}),o.jsx("button",{onClick:()=>dn("location",K),disabled:te,style:{padding:"8px 16px",backgroundColor:te?"var(--muted, #cbd5e1)":"var(--primary, #4f46e5)",color:"var(--primary-foreground, white)",border:"none",borderRadius:"6px",cursor:te?"not-allowed":"pointer",fontWeight:"500",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"8px"},children:te?" ...":K.image?" ":" "})]}),o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("div",{style:{fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginBottom:"4px"},children:""}),o.jsx("p",{style:{lineHeight:"1.6",fontSize:"1rem",margin:0},children:K.description||"  ."})]}),o.jsx("div",{style:{display:"flex",gap:"16px",fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginTop:"24px",borderTop:"1px solid var(--border, #eee)",paddingTop:"16px"},children:o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsx("strong",{style:{color:"var(--modal-text)"},children:" :"})," ",K.appearance_count||(K.scenes?K.scenes.length:0),"",K.scenes&&K.scenes.length>0&&o.jsxs("button",{onClick:()=>tr(!Nt),style:{background:"var(--modal-bg)",border:"1px solid var(--border, #e2e8f0)",borderRadius:"4px",cursor:"pointer",padding:"2px 6px",fontSize:"0.8rem",color:"var(--muted-foreground, #666)",display:"flex",alignItems:"center",gap:"4px"},children:[Nt?o.jsx(ce,{size:12}):o.jsx(se,{size:12}),Nt?"":" "]})]}),Nt&&K.scenes&&o.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px",marginTop:"10px",maxHeight:"150px",overflowY:"auto",width:"100%",padding:"4px"},children:K.scenes.map(f=>o.jsxs("button",{onClick:()=>me(f),style:{background:"var(--secondary)",border:"1px solid var(--border)",borderRadius:"4px",padding:"4px 8px",fontSize:"0.8rem",color:"var(--primary)",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px"},children:["SCENE ",f+1]},f))})]})})]})}),De&&o.jsx("div",{className:"modal-overlay",onClick:()=>wt(null),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsxs("div",{className:"modal-content",onClick:f=>f.stopPropagation(),style:{backgroundColor:"var(--modal-bg, #fff)",padding:"24px",borderRadius:"12px",width:"400px",maxWidth:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",color:"var(--modal-text, #333)",border:"1px solid var(--modal-border, #e5e7eb)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[o.jsx("h2",{style:{fontSize:"1.25rem",fontWeight:"bold",margin:0,lineHeight:1.4},children:De.summary}),o.jsx("button",{onClick:()=>wt(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:o.jsx(At,{size:20})})]}),o.jsx("div",{style:{marginBottom:"24px"},children:De.importance&&o.jsxs("div",{style:{display:"inline-block",padding:"4px 8px",backgroundColor:"var(--muted, #f1f5f9)",borderRadius:"4px",fontSize:"0.875rem",fontWeight:"500",color:"var(--muted-foreground, #475569)",marginTop:"8px"},children:[": ",De.importance]})}),o.jsx("div",{style:{display:"flex",gap:"16px",fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginTop:"16px",borderTop:"1px solid var(--border, #eee)",paddingTop:"16px"},children:o.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},children:o.jsxs("button",{onClick:()=>me(De.scene_index),style:{width:"100%",background:"var(--primary, #4F46E5)",border:"none",borderRadius:"6px",padding:"10px 16px",fontSize:"0.95rem",fontWeight:"600",color:"var(--primary-foreground, #ffffff)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"background 0.2s"},children:[o.jsxs("span",{children:["   (",De.scene_index+1,")"]}),o.jsx(fn,{size:16})]})})})]})}),ke&&o.jsx("div",{className:"modal-overlay",onClick:()=>Ct(null),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsxs("div",{className:"modal-content",onClick:f=>f.stopPropagation(),style:{backgroundColor:"var(--modal-bg, #fff)",padding:"24px",borderRadius:"12px",width:"400px",maxWidth:"90%",boxShadow:"0 10px 25px rgba(0,0,0,0.2)",color:"var(--modal-text, #333)",border:"1px solid var(--modal-border, #e5e7eb)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[o.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"bold",margin:0},children:ke.item.name||ke.item.title||"Detail"}),o.jsx("button",{onClick:()=>Ct(null),style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:o.jsx(Tt,{size:20})})]}),o.jsxs("div",{style:{marginBottom:"16px"},children:[o.jsx("div",{style:{fontSize:"0.875rem",color:"var(--muted-foreground, #666)",marginBottom:"4px"},children:ke.title.toUpperCase()}),o.jsx("div",{style:{lineHeight:"1.6",fontSize:"1rem",margin:0,maxHeight:"300px",overflowY:"auto"},children:ke.item.description||ke.item.summary||o.jsx("pre",{style:{whiteSpace:"pre-wrap",fontFamily:"monospace",fontSize:"0.8rem",backgroundColor:"var(--muted, #f1f5f9)",color:"var(--modal-text)",padding:"8px",borderRadius:"4px",border:"1px solid var(--border)"},children:JSON.stringify(ke.item,null,2)})})]})]})}),o.jsx(Yo,{}),R&&o.jsx("div",{style:{position:"fixed",bottom:"20px",right:"25px",width:"600px",height:"750px",zIndex:1002,animation:"slideUp 0.3s ease"},children:o.jsx(sc,{onClose:()=>z(!1)})}),o.jsx(oc,{isOpen:nn,onClose:()=>Qe(!1),result:Ks,isLoading:qs,onNavigateToQuote:Zs,onReanalyze:or}),o.jsx(ic,{isOpen:Yt,onClose:()=>Je(!1),messages:Vn,onSendMessage:Ys,isLoading:Ps,onClearChat:()=>{xt([]),n&&dc(n).catch(()=>{})}}),o.jsx(rc,{onNavigateToScene:me,onCheckConsistency:Js,onPredictStory:Qs,onOpenCharacterChat:i,onOpenSettings:ir,novelId:n,chapterId:r,mode:s})]})}export{Ic as ChapterDetail};
